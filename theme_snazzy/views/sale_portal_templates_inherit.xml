<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<!-- Portal Internal Page Start-->
        <template id="snazzy_website_reorder" name="Snazzy Website Reorder"></template>
    	<template id="buyitagain_button_portal_sale_order_bizople" name="Buyit Again Button Sale Order Bizople" inherit_id="sale.sale_order_portal_content">
    		<xpath expr="//td[@id='product_name']" position="inside">
    			<div class="pull-right" t-if="line.product_id.website_published">
                    <t t-if="is_view_active('theme_snazzy.snazzy_website_reorder')">
                        <button class="btn btn-secondary pt4 pb4" t-if="line.product_id.website_published" data-bs-toggle="modal" t-attf-data-bs-target="#s-p#{line.product_id.id}"> 
                            <i class="fa fa-repeat"/>
                             <span class="d-none d-md-none d-lg-inline">
                                Reorder
                            </span>
                        </button>
                        <div class="modal fade" t-attf-id="s-p#{line.product_id.id}" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered" role="document">

                                <div class="modal-content">
                                   <div class="modal-header bg-light">
                                    <h6 class="fw-bold mb-0"> Reorder</h6>
                                    <button type="button" class="btn close text-mute" data-bs-dismiss="modal" aria-label="Close">
                                        <span>x</span>
                                    </button>
                                    </div>

                                    <div class="modal-body">
                                        <form action="/shop/cart/update" method="POST">
                                            <div class="js_product js_main_product">
                                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />
                                                <t t-placeholder="select">
                                                    <input type="hidden" class="product_id" name="product_id" t-att-value="line.product_id.id" />
                                                    <input type="hidden" class="product_template_id" name="product_template_id" t-att-value="line.product_template_id" />
                                                    <t t-if="combination" t-call="website_sale.variants">
                                                        <t t-set="ul_class" t-value="'flex-column'" />
                                                        <t t-set="parent_combination" t-value="None" />
                                                    </t>
                                                    <t t-else="">
                                                        <ul class="d-none js_add_cart_variants" t-att-data-attribute_exclusions="{'exclusions: []'}"/>
                                                    </t>
                                                </t>

                                                <div class="row">
                                                    <div class="col-md-5">
                                                        <span t-field="line.product_id.image_1920" t-options="{'widget': 'image', 'preview_image': 'image_1024' if product_image_big else 'image_256'}" class="img-fluid"/>
                                                    </div>

                                                    <div class="col-md-7">
                                                        <div class="portal-page-design">
                                                            <h5 class="text-primary mb-2">
                                                                <b t-out="line.product_id.name"/>
                                                            </h5>
                                                            <div class="d-flex align-items-center mb-2">
                                                                <p class="reorder-product-price">Price: </p> 
					                                            <t t-set="combination" t-value="line.product_template_id._get_first_possible_combination()"/>
					                                            <t t-set="combination_info" t-value="line.product_template_id._get_combination_info(combination, add_qty=add_qty)"/>
                                                                <div itemprop="offers" itemscope="itemscope" itemtype="http://schema.org/Offer" class="product_price ms-2">
                                                                    <p class="oe_price_h4 css_editable_mode_hidden">
                                                                        <span t-attf-class="text-danger oe_default_price {{'' if combination_info['has_discounted_price'] else 'd-none'}}" style="text-decoration: line-through; white-space: nowrap;" t-out="combination_info['list_price']" t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>

                                                                        <span class="oe_price" style="white-space: nowrap;" t-out="combination_info['price']" t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>

                                                                        <span itemprop="price" style="display:none;" t-out="combination_info['price']"/>

                                                                        <span itemprop="priceCurrency" style="display:none;" t-out="website.currency_id.name"/>
                                                                    </p>
                                                                    <p class="css_non_editable_mode_hidden decimal_precision" t-att-data-precision="str(website.currency_id.decimal_places)">
                                                                        <span t-field="line.product_template_id.list_price" t-options='{"widget": "monetary","display_currency": line.product_template_id.currency_id}'/>
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <div class="d-flex align-items-center quantity_row mb-3">
                                                                <span>Quantity:</span>
                                                                <input type="number" class="form-control quantity" min="1" name="add_qty" t-att-value="add_qty or 1"/>
                                                            </div>
                                                            <div class="add_to_card_button">
                                                                <button name="submit" type="submit" class="btn btn-secondary btn-buy-again pt4 pb4">
                                                                    <i class="fa fa-shopping-cart"/>
                                                                    <span class="d-none d-md-none d-lg-inline w-100">Add to Cart</span>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div> 

                                    <div class="modal-footer bg-light">
                                        <button type="button" class="btn btn-secondary btn-close-product" data-bs-dismiss="modal">Close</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>
            </xpath>
        </template>
    <!-- Portal Internal Page End-->
    
    <!-- Portal Quick View Start-->
        <template id="qucik_view_product_ordered_bizople" name="Quick View Product in Portal Sale" inherit_id="sale.portal_my_orders">
            <xpath expr="//a[@t-att-href='order.get_portal_url()']" position="after">
                <t t-if="is_view_active('theme_snazzy.snazzy_website_reorder')">
                    <button class="btn btn-secondary btn-portal-sale" type="button" data-bs-toggle="collapse" t-attf-data-bs-target="##{order.name}" aria-expanded="false" aria-controls="collapseExample" style="">
                        <i class="fa fa-plus" ></i>
                    </button>
                    <div t-att-id="order.name" class="collapse mt16 reorder_table">            
                        <table class="table table-sm">
                            <thead class="bg-100">
                                <tr>
                                    <th class="text-start">Products</th>
                                    <th></th>
                                    <th class="text-end">Quantity</th>
                                    <th t-attf-class="text-end {{ 'd-none d-sm-table-cell' if report_type == 'html' else '' }}">Unit Price</th>
                                    <th t-if="display_discount" t-attf-class="text-end {{ 'd-none d-sm-table-cell' if report_type == 'html' else '' }}">
                                        <span>Disc.%</span>
                                    </th>
                                    <th t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                        <span>Taxes</span>
                                    </th>
                                    <th class="text-end" >
                                        <span t-if="website.show_line_subtotals_tax_selection == 'tax_excluded'">Amount</span>
                                        <span t-else="">Total Price</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="sale_tbody">   
                                <t t-foreach="order.order_line" t-as="line">
                                    <tr t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">
                                        <t t-if="not line.display_type">
                                            <td id="product_name">
                                                <span t-field="line.name"/>
                                            </td>

                                            <td> 
                                                <button class="btn btn-secondary pt4 pb4" t-if="line.product_id.website_published and line.product_id.active" data-bs-toggle="modal" t-attf-data-bs-target="#s-p#{line.product_id.id}"> 
                                                    <i class="fa fa-repeat"/>
                                                     <span class="d-none d-md-none d-lg-inline">
                                                        Reorder
                                                    </span>
                                                </button>

                                                <div class="modal fade" t-attf-id="s-p#{line.product_id.id}" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    												<div class="modal-dialog modal-dialog-centered" role="document">

    													<div class="modal-content">
    													   <div class="modal-header bg-light">
                                                                <h6 class="fw-bold mb-0"> Reorder</h6>
                                                                <button type="button" class="btn close text-mute" data-bs-dismiss="modal" aria-label="Close">
                                                                    <span>x</span>
                                                                </button>
                                                            </div>

                                                            <div class="modal-body">
                                                                <form action="/shop/cart/update" method="POST">
                                                                    <div class="js_product js_main_product">

                                                                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />
                                                                        <t t-placeholder="select">
                                                                            <input type="hidden" class="product_id" name="product_id" t-att-value="line.product_id.id" />
                                                                            <input type="hidden" class="product_template_id" name="product_template_id" t-att-value="line.product_template_id" />
                                                                            <t t-if="combination" t-call="website_sale.variants">
                                                                                <t t-set="ul_class" t-value="'flex-column'" />
                                                                                <t t-set="parent_combination" t-value="None" />
                                                                            </t>
                                                                            <t t-else="">
                                                                                <ul class="d-none js_add_cart_variants" t-att-data-attribute_exclusions="{'exclusions: []'}"/>
                                                                            </t>
                                                                        </t>

                                                                        <div class="row">
                                                                            <div class="col-md-5">
                                                                                <span t-field="line.product_id.image_1920" t-options="{'widget': 'image', 'preview_image': 'image_1024' if product_image_big else 'image_256'}" class="img-fluid"/>
                                                                            </div>
                                                                            <div class="col-md-7">
                                                                                <div class="portal-page-design">
                                                                                    <h5 class="text-primary mb-2">
                                                                                        <b t-out="line.product_id.name"/>
                                                                                    </h5>
                                                                                    <div class="d-flex align-items-center mb-2">
                                                                                        <p class="reorder-product-price">Price: </p> 
                                                                                             
                                                                                        <t t-set="combination_price" t-value="line.product_template_id._get_first_possible_combination()"/>
					                                                                    <t t-set="combination_info" t-value="line.product_template_id._get_combination_info(combination_price, add_qty=add_qty)"/>
                                                                                        <div itemprop="offers" itemscope="itemscope" itemtype="http://schema.org/Offer" class="product_price ms-2">
                                                                                            <p class="oe_price_h4 css_editable_mode_hidden">
                                                                                                <span t-attf-class="text-danger oe_default_price {{'' if combination_info['has_discounted_price'] else 'd-none'}}" style="text-decoration: line-through; white-space: nowrap;" t-out="combination_info['list_price']" t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>
                        
                                                                                                <span class="oe_price" style="white-space: nowrap;" t-out="combination_info['price']" t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>
                        
                                                                                                <span itemprop="price" style="display:none;" t-out="combination_info['price']"/>
                        
                                                                                                <span itemprop="priceCurrency" style="display:none;" t-out="website.currency_id.name"/>
                                                                                            </p>
                                                                                            <p class="css_non_editable_mode_hidden decimal_precision" t-att-data-precision="str(website.currency_id.decimal_places)">
                                                                                                <span t-field="line.product_template_id.list_price" t-options='{"widget": "monetary","display_currency": line.product_template_id.currency_id}'/>
                                                                                            </p>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div class="d-flex align-items-center quantity_row mb-3">
                                                                                        <p class="reorder-product-quantity">Quantity: </p>
                                                                                        <input type="number" class="form-control quantity" min="1" name="add_qty" t-att-value="add_qty or 1"/>
                                                                                    </div>
                                                                                    <div class="add_to_card_button">
                                                                                        <button name="submit" type="submit" class="btn btn-secondary btn-buy-again pt4 pb4 w-100">
                                                                                            <i class="fa fa-shopping-cart"/>
                                                                                            <span class="d-none d-md-none d-lg-inline">Add to Cart</span>
                                                                                        </button>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </form>
                                                            </div> 

                                                            <div class="modal-footer bg-light">
                                                                <button type="button" class="btn btn-secondary btn-close-product" data-bs-dismiss="modal">
                                                                    Close
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                          
                                            <td class="text-end">
                                                <div id="quote_qty">
                                                    <span t-field="line.product_uom_qty"/>
                                                    <span t-field="line.product_uom" groups="uom.group_uom"/>
                                                </div>
                                            </td>

                                            <td t-attf-class="text-end {{ 'd-none d-sm-table-cell' if report_type == 'html' else '' }}">
                                                <div
                                                    t-if="line.discount &gt;= 0"
                                                    t-field="line.price_unit"
                                                    t-att-style="line.discount and 'text-decoration: line-through' or None"
                                                    t-att-class="(line.discount and 'text-danger' or '') + ' text-end'"
                                                />
                                                <div t-if="line.discount">
                                                    <t t-out="(1-line.discount / 100.0) * line.price_unit" t-options='{"widget": "float", "decimal_precision": "Product Price"}'/>
                                                </div>
                                            </td>

                                            <td t-if="display_discount" t-attf-class="text-end {{ 'd-none d-sm-table-cell' if report_type == 'html' else '' }}">
                                                <strong t-if="line.discount &gt; 0" class="text-info">
                                                    <t t-out="((line.discount % 1) and '%s' or '%d') % line.discount"/>%
                                                </strong>
                                            </td>

                                            <td t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}" id="taxes">
                                                <span t-out="', '.join(map(lambda x: (x.name), line.tax_id))"/>
                                            </td>

                                            <td class="text-end">
                                                <span class="oe_order_line_price_subtotal" t-field="line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                                <span class="oe_order_line_price_total" t-field="line.price_total"/>
                                            </td>
                                        </t>
                                    </tr>                      
                                </t>
                            </tbody>
                        </table>
                    </div>
                </t>
            </xpath>
        </template>
    <!-- Portal Quick View End-->
</odoo>