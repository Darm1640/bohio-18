<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Heredar vista de formulario de propiedad para añadir campos BOHIO -->
    <record id="view_property_form_bohio" model="ir.ui.view">
        <field name="name">property.form.bohio</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="real_estate_bits.view_property_form"/>
        <field name="arch" type="xml">
            <!-- Añadir código BOHIO automático -->
            <xpath expr="//field[@name='default_code']" position="attributes">
                <attribute name="placeholder">BOH-XXX (Se genera automáticamente)</attribute>
            </xpath>

            <!-- Añadir grupo de imágenes mejorado en el notebook existente -->
            <!-- <xpath expr="//notebook" position="inside">
                <page string="Galería BOHIO" name="bohio_gallery">
                    <group>
                        <field name="product_variant_image_ids" widget="many2many_binary" nolabel="1"/>
                    </group>
                </page>
            </xpath> -->
        </field>
    </record>

    <!-- Vista Kanban personalizada BOHIO -->
    <record id="view_property_kanban_bohio" model="ir.ui.view">
        <field name="name">property.kanban.bohio</field>
        <field name="model">product.template</field>
        <field name="arch" type="xml">
            <kanban default_group_by="state" sample="1">
                <field name="id"/>
                <field name="name"/>
                <field name="default_code"/>
                <field name="image_1920"/>
                <field name="state"/>
                <field name="list_price"/>
                <field name="property_area"/>
                <field name="num_bedrooms"/>
                <field name="num_bathrooms"/>
                <field name="city"/>
                <field name="neighborhood"/>
                <field name="type_service"/>
                <field name="currency_id"/>
                <progressbar field="state" colors='{"free": "success", "reserved": "warning", "on_lease": "info", "blocked": "danger"}'/>
                <templates>
                    <t t-name="card">
                        <main>
                            <div class="o_kanban_image">
                                <field name="image_1920" widget="image" class="o_image_64_contain"/>
                            </div>
                            <div class="oe_kanban_details">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <span t-if="record.default_code.value">[<field name="default_code"/>] </span>
                                            <field name="name"/>
                                        </strong>
                                    </div>
                                </div>
                                <div class="o_kanban_tags_section">
                                    <field name="state" widget="label_selection"
                                           options="{'classes': {'free': 'success', 'reserved': 'warning', 'on_lease': 'info', 'blocked': 'danger'}}"/>
                                </div>
                                <div class="text-muted">
                                    <i class="fa fa-map-marker"/>
                                    <field name="city"/> - <field name="neighborhood"/>
                                </div>
                                <div class="mt-1">
                                    <span t-if="record.type_service.raw_value == 'sale'" class="badge badge-primary">Venta</span>
                                    <span t-if="record.type_service.raw_value == 'rent'" class="badge badge-info">Arriendo</span>
                                    <span t-if="record.type_service.raw_value == 'sale_rent'" class="badge badge-success">Venta/Arriendo</span>
                                </div>
                                <div class="mt-1">
                                    <strong>
                                        $<t t-esc="Math.round(record.list_price.value).toLocaleString()"/>
                                    </strong>
                                </div>
                                <div class="text-muted o_kanban_record_subtitle">
                                    <span t-if="record.property_area.raw_value">
                                        <i class="fa fa-home"/> <field name="property_area"/> m²
                                    </span>
                                    <span t-if="record.num_bedrooms.raw_value" class="ms-2">
                                        <i class="fa fa-bed"/> <field name="num_bedrooms"/>
                                    </span>
                                    <span t-if="record.num_bathrooms.raw_value" class="ms-2">
                                        <i class="fa fa-bath"/> <field name="num_bathrooms"/>
                                    </span>
                                </div>
                            </div>
                        </main>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Añadir acción con vista Kanban BOHIO -->
    <record id="action_property_bohio" model="ir.actions.act_window">
        <field name="name">Propiedades BOHIO</field>
        <field name="res_model">product.template</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="domain">[('is_property', '=', True)]</field>
        <field name="context">{'default_is_property': True, 'search_default_available': 1}</field>
        <field name="view_ids" eval="[(5, 0, 0),
            (0, 0, {'view_mode': 'kanban', 'view_id': ref('view_property_kanban_bohio')}),
            (0, 0, {'view_mode': 'form', 'view_id': ref('view_property_form_bohio')})]"/>
    </record>

    <!-- Menú BOHIO -->
    <menuitem id="menu_bohio_properties"
              name="Propiedades BOHIO"
              action="action_property_bohio"
              sequence="1"/>
</odoo>