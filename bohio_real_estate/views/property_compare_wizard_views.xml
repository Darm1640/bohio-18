<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vista Formulario del Wizard de Comparación -->
    <record id="view_property_compare_wizard_form" model="ir.ui.view">
        <field name="name">property.compare.wizard.form</field>
        <field name="model">property.compare.wizard</field>
        <field name="arch" type="xml">
            <form string="Comparar Propiedades">
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="id" invisible="1"/>
                            Comparación de Propiedades
                        </h1>
                    </div>

                    <group>
                        <group string="Propiedades a Comparar">
                            <field name="property_ids" widget="many2many_tags"
                                   options="{'no_create': True, 'no_create_edit': True}"
                                   placeholder="Seleccione las propiedades a comparar..."/>
                        </group>

                        <group string="Información del Cliente">
                            <field name="client_id" placeholder="Buscar cliente existente..."/>
                            <field name="client_name" placeholder="Nombre completo"/>
                            <field name="client_email" placeholder="correo@ejemplo.com"/>
                            <field name="client_phone" placeholder="+57 300 123 4567"/>
                        </group>
                    </group>

                    <group>
                        <group string="Opciones de Comparación">
                            <field name="include_images"/>
                            <field name="include_amenities"/>
                            <field name="include_price_details"/>
                            <field name="include_location_map"/>
                        </group>

                        <group string="Formato de Salida">
                            <field name="output_format" widget="radio"/>
                        </group>
                    </group>

                    <group string="Notas Adicionales" colspan="4">
                        <field name="notes" nolabel="1" placeholder="Agregar cualquier nota o comentario adicional para el cliente..."/>
                    </group>
                </sheet>

                <footer>
                    <button name="action_print_comparison"
                            string="Generar Comparación"
                            type="object"
                            class="btn-primary"
                            icon="fa-print"/>
                    <button name="action_send_by_email"
                            string="Enviar por Email"
                            type="object"
                            icon="fa-envelope"
                            invisible="not client_email"/>
                    <button name="action_create_lead"
                            string="Crear Oportunidad"
                            type="object"
                            icon="fa-plus-circle"
                            invisible="not client_name"/>
                    <button string="Cancelar" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Acción del Wizard -->
    <record id="action_property_compare_wizard" model="ir.actions.act_window">
        <field name="name">Comparar Propiedades</field>
        <field name="res_model">property.compare.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Seleccione las propiedades a comparar
            </p>
            <p>
                Este asistente le permite comparar hasta 6 propiedades y generar un reporte profesional
                con la imagen de marca de BOHÍO Inmobiliaria.
            </p>
        </field>
    </record>

    <!-- Acción en el menú de acciones de product.template -->
    <record id="action_property_compare_multi" model="ir.actions.server">
        <field name="name">Comparar Propiedades Seleccionadas</field>
        <field name="model_id" ref="product.model_product_template"/>
        <field name="binding_model_id" ref="product.model_product_template"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
if records:
    # Filtrar solo propiedades
    properties = records.filtered(lambda r: r.is_property if hasattr(r, 'is_property') else False)
    if properties:
        action = env.ref('bohio_real_estate.action_property_compare_wizard').read()[0]
        action['context'] = {
            'default_property_ids': [(6, 0, properties.ids)],
        }
    else:
        raise Warning('Por favor seleccione solo propiedades para comparar.')
else:
    raise Warning('Por favor seleccione al menos 2 propiedades para comparar.')
        </field>
    </record>
</odoo>