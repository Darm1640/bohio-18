<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_crm_lead_kanban_bohio_metrics" model="ir.ui.view">
        <field name="name">crm.lead.kanban.bohio.metrics</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_case_kanban_view_leads"/>
        <field name="arch" type="xml">

            <!-- 1) Ajuste seguro del nodo raíz kanban -->
            <xpath expr="//kanban" position="attributes">
                <attribute name="class" add="bohio-metrics-enabled"/>
            </xpath>

            <!-- 2) Micro-métricas dentro de la tarjeta, antes del nombre -->
            <xpath expr="//kanban/templates/t[@t-name='card']/field[@name='name']" position="before">
                <div class="bohio-card-micro-metrics d-flex gap-2 align-items-center mb-1">
                    <t t-if="record.expected_revenue and record.expected_revenue.raw_value">
                        <span class="badge text-bg-light">
                            <t t-call="web.basic_monetary">
                                <t t-set="amount" t-value="record.expected_revenue.raw_value"/>
                                <t t-set="currency" t-value="record.company_currency.raw_value"/>
                            </t>
                        </span>
                    </t>
                    <t t-if="record.activity_state and record.activity_state.raw_value">
                        <span class="badge text-bg-light">
                            <t t-esc="record.activity_state.value"/>
                        </span>
                    </t>
                    <t t-if="record.stage_id and record.stage_id.value">
                        <span class="badge text-bg-light">
                            <t t-esc="record.stage_id.value"/>
                        </span>
                    </t>
                </div>
            </xpath>

            <xpath expr="//kanban/templates/t[@t-name='card']/footer/div/field[@name='priority']" position="before">
                <field name="stage_id" class="me-2" widget="badge"/>
            </xpath>

        </field>
    </record>


    <record id="action_bohio_crm_metrics" model="ir.actions.act_window">
        <field name="name">CRM Bohío - Métricas</field>
        <field name="res_model">crm.lead</field>
        <field name="view_mode">kanban,list,form,calendar,pivot,graph,activity</field>
        <field name="domain">[('type', '=', 'opportunity')]</field>
        <field name="context">{
            'default_type': 'opportunity',
            'search_default_my_opportunities': 1,
            'show_metrics_dashboard': True
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Crear nueva oportunidad
            </p>
            <p>
                Gestione sus oportunidades inmobiliarias con métricas en tiempo real
            </p>
        </field>
    </record>
</odoo>