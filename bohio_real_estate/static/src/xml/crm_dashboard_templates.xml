<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="bohio_real_estate.CrmDashboard">
        <div class="bohio_dashboard_container">
            <t t-if="state.isLoading">
                <div class="text-center p-5">
                    <i class="fa fa-spinner fa-spin fa-3x text-muted"/>
                    <p class="mt-3 text-muted">Cargando dashboard...</p>
                </div>
            </t>

            <t t-else="">
                <!-- Métricas principales -->
                <div class="row bohio_metrics_row">
                    <div class="col-lg-3 col-md-6">
                        <div class="bohio_metric_card bohio_card_leads">
                            <div class="metric_icon">
                                <i class="fa fa-users fa-2x"/>
                            </div>
                            <div class="metric_content">
                                <h3 class="metric_value" t-esc="state.metrics.total_leads"/>
                                <p class="metric_label">Leads Activos</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="bohio_metric_card bohio_card_revenue">
                            <div class="metric_icon">
                                <i class="fa fa-dollar fa-2x"/>
                            </div>
                            <div class="metric_content">
                                <h3 class="metric_value" t-esc="formatCurrency(state.metrics.expected_revenue)"/>
                                <p class="metric_label">Ingreso Esperado</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="bohio_metric_card bohio_card_properties">
                            <div class="metric_icon">
                                <i class="fa fa-building fa-2x"/>
                            </div>
                            <div class="metric_content">
                                <h3 class="metric_value" t-esc="state.metrics.active_properties"/>
                                <p class="metric_label">Propiedades Disponibles</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="bohio_metric_card bohio_card_conversion">
                            <div class="metric_icon">
                                <i class="fa fa-line-chart fa-2x"/>
                            </div>
                            <div class="metric_content">
                                <h3 class="metric_value"><t t-esc="state.metrics.conversion_rate"/>%</h3>
                                <p class="metric_label">Tasa Conversión</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pipeline de ventas -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="bohio_pipeline_section">
                            <h4 class="section_title">
                                <i class="fa fa-filter"/> Pipeline de Ventas
                            </h4>
                            <div class="pipeline_stages">
                                <t t-foreach="state.pipeline" t-as="stage" t-key="stage.id">
                                    <div class="pipeline_stage">
                                        <div class="stage_name" t-esc="stage.name"/>
                                        <div class="stage_count" t-esc="stage.count"/>
                                        <div class="stage_amount" t-esc="formatCurrency(stage.amount)"/>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <!-- Actividades próximas -->
                    <div class="col-lg-6">
                        <div class="bohio_activities_section">
                            <h4 class="section_title">
                                <i class="fa fa-calendar-check-o"/> Actividades Próximas
                            </h4>
                            <div class="activities_list">
                                <t t-foreach="state.activities" t-as="activity" t-key="activity.id">
                                    <div class="activity_item">
                                        <div class="activity_icon">
                                            <i t-att-class="'fa ' + getActivityIcon(activity.activity_type_id[1])"/>
                                        </div>
                                        <div class="activity_details">
                                            <div class="activity_title" t-esc="activity.res_name"/>
                                            <div class="activity_date">
                                                <t t-esc="formatDate(activity.date_deadline)"/> ·
                                                <t t-esc="activity.user_id[1]"/>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                                <t t-if="!state.activities.length">
                                    <p class="text-muted text-center py-3">No hay actividades próximas</p>
                                </t>
                            </div>
                        </div>
                    </div>

                    <!-- Top vendedores -->
                    <div class="col-lg-6">
                        <div class="bohio_sellers_section">
                            <h4 class="section_title">
                                <i class="fa fa-trophy"/> Top Vendedores
                            </h4>
                            <div class="sellers_list">
                                <t t-foreach="state.topSellers" t-as="seller" t-key="seller.id">
                                    <div class="seller_item">
                                        <div class="seller_rank" t-esc="seller_index + 1"/>
                                        <div class="seller_info">
                                            <div class="seller_name" t-esc="seller.name"/>
                                            <div class="seller_stats">
                                                <t t-esc="seller.count"/> oportunidades
                                            </div>
                                        </div>
                                        <div class="seller_revenue">
                                            <div class="revenue_amount" t-esc="formatCurrency(seller.revenue)"/>
                                            <div class="revenue_deals">Total esperado</div>
                                        </div>
                                    </div>
                                </t>
                                <t t-if="!state.topSellers.length">
                                    <p class="text-muted text-center py-3">No hay datos de vendedores</p>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Propiedades destacadas -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="bohio_properties_section">
                            <h4 class="section_title">
                                <i class="fa fa-star"/> Propiedades Disponibles
                            </h4>
                            <div class="properties_grid">
                                <t t-foreach="state.properties" t-as="property" t-key="property.id">
                                    <div class="property_card">
                                        <div class="property_image">
                                            <i class="fa fa-building"/>
                                        </div>
                                        <div class="property_details">
                                            <div class="property_name" t-esc="property.name"/>
                                            <div class="property_location">
                                                <i class="fa fa-map-marker"/>
                                                <t t-esc="property.default_code or 'Sin código'"/>
                                            </div>
                                            <div class="property_price" t-esc="formatCurrency(property.list_price)"/>
                                            <div class="property_badges">
                                                <span class="badge">Disponible</span>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                                <t t-if="!state.properties.length">
                                    <p class="text-muted text-center py-3">No hay propiedades disponibles</p>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </div>
    </t>

</templates>