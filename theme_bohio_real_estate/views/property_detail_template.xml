<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="theme_bohio_real_estate.property_detail" name="Property Detail">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure property-detail-page">
                <div class="container mt-4 mb-5">
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="card shadow-sm mb-4 border-0" style="border-radius: 16px; overflow: hidden;">
                                <!-- GALERÍA DE IMÁGENES CON CARRUSEL -->
                                <div class="position-relative property-gallery-container">
                                    <!-- Badges superiores -->
                                    <div class="position-absolute top-0 start-0 p-3" style="z-index: 10;">
                                        <span class="badge px-3 py-2" style="background: #E31E24; font-size: 0.9rem;">
                                            <i class="fa fa-star me-1"></i>DESTACADO
                                        </span>
                                    </div>

                                    <!-- Botones de acción (Favorito, Compartir, Reportar) -->
                                    <div class="position-absolute top-0 end-0 p-3 d-flex gap-2" style="z-index: 10;">
                                        <button class="btn btn-light rounded-circle shadow" style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;" title="Favorito">
                                            <i class="fa fa-heart text-danger"></i>
                                        </button>
                                        <button class="btn btn-light rounded-circle shadow" style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;" title="Compartir">
                                            <i class="fa fa-share-alt text-primary"></i>
                                        </button>
                                        <button class="btn btn-light rounded-circle shadow" style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;" title="Reportar">
                                            <i class="fa fa-flag text-warning"></i>
                                        </button>
                                    </div>

                                    <!-- Carrusel de Imágenes -->
                                    <div id="propertyImageCarousel" class="carousel slide" data-bs-ride="false">
                                        <div class="carousel-inner">
                                            <!-- Usar product_template_image_ids de website_sale -->
                                            <t t-set="images_list" t-value="property.product_template_image_ids or []"/>

                                            <t t-if="len(images_list) > 0">
                                                <!-- Imágenes de la galería -->
                                                <t t-foreach="images_list" t-as="img">
                                                    <div t-att-class="'carousel-item' if img_index > 0 else 'carousel-item active'">
                                                        <div style="width: 100%; padding-top: 56.25%; position: relative; background: #f8f9fa; overflow: hidden; cursor: zoom-in;" t-att-onclick="'openImageZoom(%s)' % img_index">
                                                            <img t-att-src="'/web/image/product.image/%s/image_1920' % img.id"
                                                                 class="position-absolute top-0 start-0 w-100 h-100"
                                                                 style="object-fit: cover;"
                                                                 t-att-alt="property.name"
                                                                 t-att-data-index="img_index"/>
                                                        </div>
                                                    </div>
                                                </t>
                                            </t>
                                            <t t-elif="property.image_1920">
                                                <!-- Imagen principal si no hay galería -->
                                                <div class="carousel-item active">
                                                    <div style="width: 100%; padding-top: 56.25%; position: relative; background: #f8f9fa; overflow: hidden; cursor: zoom-in;" onclick="openImageZoom(0)">
                                                        <img t-att-src="'/web/image/product.template/%s/image_1920' % property.id"
                                                             class="position-absolute top-0 start-0 w-100 h-100"
                                                             style="object-fit: cover;"
                                                             t-att-alt="property.name"
                                                             data-index="0"/>
                                                    </div>
                                                </div>
                                            </t>
                                            <t t-else="">
                                                <!-- Placeholder si no hay imágenes -->
                                                <div class="carousel-item active">
                                                    <div style="width: 100%; padding-top: 56.25%; position: relative; background: #f8f9fa; overflow: hidden;">
                                                        <img src="/theme_bohio_real_estate/static/src/img/banner1.jpg"
                                                             class="position-absolute top-0 start-0 w-100 h-100"
                                                             style="object-fit: cover; opacity: 0.7; filter: brightness(0.8);"
                                                             alt="Propiedad BOHIO"/>
                                                        <div class="position-absolute top-50 start-50 translate-middle text-white text-center"
                                                             style="background: rgba(227, 30, 36, 0.95); padding: 20px 40px; border-radius: 10px;">
                                                            <i class="fa fa-image fa-3x mb-2"></i>
                                                            <p class="mb-0 fw-bold fs-5">Imagen no disponible</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </t>
                                        </div>

                                        <!-- Controles del Carrusel (Anterior/Siguiente) -->
                                        <t t-if="len(images_list) > 1">
                                            <button class="carousel-control-prev" type="button" data-bs-target="#propertyImageCarousel" data-bs-slide="prev" style="width: 50px;">
                                                <div class="bg-white rounded-circle d-flex align-items-center justify-content-center shadow" style="width: 40px; height: 40px;">
                                                    <i class="fa fa-chevron-left text-dark"></i>
                                                </div>
                                                <span class="visually-hidden">Anterior</span>
                                            </button>
                                            <button class="carousel-control-next" type="button" data-bs-target="#propertyImageCarousel" data-bs-slide="next" style="width: 50px;">
                                                <div class="bg-white rounded-circle d-flex align-items-center justify-content-center shadow" style="width: 40px; height: 40px;">
                                                    <i class="fa fa-chevron-right text-dark"></i>
                                                </div>
                                                <span class="visually-hidden">Siguiente</span>
                                            </button>
                                        </t>
                                    </div>

                                    <!-- Contador y Botones en la parte inferior de la imagen -->
                                    <div class="position-absolute bottom-0 start-0 end-0 p-3 d-flex justify-content-between align-items-center" style="background: linear-gradient(to top, rgba(0,0,0,0.7), transparent); z-index: 10;">
                                        <!-- Contador de Imágenes -->
                                        <t t-set="total_images" t-value="len(property.product_template_image_ids) if property.product_template_image_ids else (1 if property.image_1920 else 1)"/>
                                        <div class="text-white fw-bold px-3 py-2 rounded" style="background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);">
                                            <i class="fa fa-camera me-2"></i>
                                            <span id="currentImageIndex">1</span> / <span id="totalImages" t-esc="total_images"/>
                                        </div>

                                        <!-- Botones Galería y Mapa -->
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-light px-3 py-2 fw-bold" onclick="openGalleryModal()" t-if="total_images > 1">
                                                <i class="fa fa-th me-2"></i>Galería
                                            </button>
                                            <button class="btn btn-light px-3 py-2 fw-bold" onclick="toggleMapView()" t-if="property.latitude and property.longitude">
                                                <i class="fa fa-map me-2"></i>Mapa
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-3">
                                        <div>
                                            <h1 class="h2 mb-2" t-esc="property.name"/>
                                            <p class="text-muted mb-0">
                                                <i class="fa fa-tag"/> Código: <strong t-esc="property.default_code or 'N/A'"/>
                                            </p>
                                        </div>
                                        <div class="text-end">
                                            <!-- Precio de Venta -->
                                            <t t-if="property.type_service == 'sale' and property.net_price">
                                                <h3 class="text-primary mb-0">
                                                    <span t-field="property.net_price" t-options="{'widget': 'monetary', 'display_currency': property.currency_id}"/>
                                                </h3>
                                                <p class="text-muted small mb-0">Precio de Venta</p>
                                                <p class="text-muted small mb-0" t-if="property.price_per_unit">
                                                    + <span t-field="property.list_price" t-options="{'widget': 'monetary', 'display_currency': property.currency_id}"/> administración
                                                </p>
                                            </t>

                                            <!-- Precio de Arriendo -->
                                            <t t-if="property.type_service == 'rent' and property.net_rental_price">
                                                <h3 class="text-primary mb-0">
                                                    <span t-field="property.net_rental_price" t-options="{'widget': 'monetary', 'display_currency': property.currency_id}"/>
                                                    <small class="fs-6 text-muted">/ mes</small>
                                                </h3>
                                            </t>

                                            <!-- Fallback: list_price si no hay net_price -->
                                            <t t-if="not property.net_price and not property.net_rental_price">
                                                <h3 class="text-primary mb-0">
                                                    <span t-field="property.list_price" t-options="{'widget': 'monetary', 'display_currency': property.currency_id}"/>
                                                </h3>
                                            </t>

                                            <span t-if="property.type_service" class="badge bg-info mt-2">
                                                <span t-esc="dict(property._fields['type_service'].selection).get(property.type_service)"/>
                                            </span>
                                        </div>
                                    </div>

                                    <!-- OBSERVACIONES DESTACADAS -->
                                    <t t-if="property.observations">
                                        <div class="alert alert-light border-start border-danger border-4 mb-4">
                                            <h5 class="text-danger mb-3"><i class="fa fa-comment-o"/> Descripción de la Propiedad</h5>
                                            <div t-field="property.observations" class="text-muted" style="white-space: pre-wrap;"/>
                                        </div>
                                    </t>

                                    <hr/>

                                    <!-- UBICACIÓN DETALLADA -->
                                    <div class="row mb-4">
                                        <div class="col-12">
                                            <div class="card bg-light border-0">
                                                <div class="card-body">
                                                    <h5 class="text-danger mb-3"><i class="fa fa-map-marker"/> Ubicación Completa</h5>
                                                    <div class="row">
                                                        <div class="col-md-6 mb-2" t-if="property.address">
                                                            <i class="fa fa-home text-danger me-2"/>
                                                            <strong>Dirección:</strong> <span t-esc="property.address"/>
                                                        </div>
                                                        <div class="col-md-6 mb-2" t-if="property.region_id">
                                                            <i class="fa fa-map text-danger me-2"/>
                                                            <strong>Barrio:</strong> <span t-esc="property.region_id.name"/>
                                                        </div>
                                                        <div class="col-md-6 mb-2" t-if="property.neighborhood">
                                                            <i class="fa fa-building text-danger me-2"/>
                                                            <strong>Sector:</strong> <span t-esc="property.neighborhood"/>
                                                        </div>
                                                        <div class="col-md-6 mb-2" t-if="property.city">
                                                            <i class="fa fa-map-marker text-danger me-2"/>
                                                            <strong>Ciudad:</strong> <span t-esc="property.city"/>
                                                        </div>
                                                        <div class="col-md-6 mb-2" t-if="property.state_id">
                                                            <i class="fa fa-globe text-danger me-2"/>
                                                            <strong>Departamento:</strong> <span t-esc="property.state_id.name"/>
                                                        </div>
                                                        <div class="col-md-6 mb-2" t-if="property.stratum">
                                                            <i class="fa fa-star text-warning me-2"/>
                                                            <strong>Estrato:</strong> <span t-esc="dict(property._fields['stratum'].selection).get(property.stratum)"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- CARACTERÍSTICAS PRINCIPALES -->
                                    <div class="row mb-4">
                                        <div class="col-12">
                                            <h5 class="text-danger mb-3"><i class="fa fa-list-ul"/> Características Principales</h5>
                                        </div>
                                        <div class="col-md-3 col-6 mb-3" t-if="property.property_area">
                                            <div class="text-center p-3 bg-light rounded">
                                                <i class="fa fa-arrows-alt fa-2x text-danger mb-2"/>
                                                <h4 class="mb-0 text-danger" t-esc="'%.0f' % property.property_area"/>
                                                <small class="text-muted">m² Área Total</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 col-6 mb-3" t-if="property.num_bedrooms">
                                            <div class="text-center p-3 bg-light rounded">
                                                <i class="fa fa-bed fa-2x text-danger mb-2"/>
                                                <h4 class="mb-0 text-danger" t-esc="property.num_bedrooms"/>
                                                <small class="text-muted">Habitaciones</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 col-6 mb-3" t-if="property.num_bathrooms">
                                            <div class="text-center p-3 bg-light rounded">
                                                <i class="fa fa-bath fa-2x text-danger mb-2"/>
                                                <h4 class="mb-0 text-danger" t-esc="property.num_bathrooms"/>
                                                <small class="text-muted">Baños</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 col-6 mb-3" t-if="property.covered_parking or property.uncovered_parking">
                                            <div class="text-center p-3 bg-light rounded">
                                                <i class="fa fa-car fa-2x text-danger mb-2"/>
                                                <h4 class="mb-0 text-danger" t-esc="(property.covered_parking or 0) + (property.uncovered_parking or 0)"/>
                                                <small class="text-muted">Parqueaderos</small>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Mapa (inicialmente oculto) -->
                                    <div id="mapViewSection" class="mb-4" style="display: none;">
                                        <hr/>
                                        <h5><i class="fa fa-map text-primary"/> Ubicación en el Mapa</h5>
                                        <div id="property_map" style="height: 400px; width: 100%;" class="mb-4"
                                             t-att-data-lat="property.latitude"
                                             t-att-data-lng="property.longitude"
                                             t-att-data-name="property.name"/>
                                    </div>

                                    <!-- Resto del contenido... (características, amenidades, etc.) -->
                                    <!-- Aquí irían todas las secciones de características que ya teníaslas dejo igual) -->
                                </div>
                            </div>
                        </div>

                        <!-- Sidebar derecho con formulario de contacto -->
                        <div class="col-lg-4">
                            <!-- FORMULARIO DE CONTACTO -->
                            <div class="card shadow-sm sticky-top mb-4" style="top: 20px; border: 2px solid #E31E24;">
                                <div class="card-header text-white" style="background: #E31E24;">
                                    <h5 class="mb-0"><i class="fa fa-envelope"/> Contactar</h5>
                                </div>
                                <div class="card-body">
                                    <form action="/contact/property" t-att-data-property-id="property.id" method="post" class="property-contact-form">
                                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                        <input type="hidden" name="property_id" t-att-value="property.id"/>

                                        <div class="mb-3">
                                            <label class="form-label fw-bold">Nombre Completo *</label>
                                            <input type="text" name="name" class="form-control" required="required" placeholder="Tu nombre completo"/>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label fw-bold">Correo Electrónico *</label>
                                            <input type="email" name="email" class="form-control" required="required" placeholder="tu@email.com"/>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label fw-bold">Teléfono *</label>
                                            <input type="tel" name="phone" class="form-control" required="required" placeholder="+57 300 123 4567"/>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label fw-bold">Mensaje</label>
                                            <textarea name="message" class="form-control" rows="4" placeholder="Estoy interesado en esta propiedad..."></textarea>
                                        </div>

                                        <button type="submit" class="btn w-100 text-white" style="background: #E31E24; border: none;">
                                            <i class="fa fa-send"/> Enviar Consulta
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MODAL DE GALERÍA EN CUADRÍCULA -->
            <div class="modal fade" id="galleryModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-xl modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title"><i class="fa fa-th me-2"></i>Galería de Imágenes</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row g-3" id="galleryGrid">
                                <!-- Imágenes se cargarán dinámicamente -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MODAL DE ZOOM FULLSCREEN (LIGHTBOX) -->
            <div class="modal fade" id="imageZoomModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="true">
                <div class="modal-dialog modal-fullscreen">
                    <div class="modal-content bg-dark">
                        <!-- Header con botón cerrar y contador -->
                        <div class="position-absolute top-0 start-0 end-0 p-3 d-flex justify-content-between align-items-center" style="z-index: 1055; background: linear-gradient(to bottom, rgba(0,0,0,0.7), transparent);">
                            <div class="text-white fw-bold">
                                <i class="fa fa-camera me-2"></i>
                                <span id="zoomImageIndex">1</span> / <span id="zoomTotalImages">1</span>
                            </div>
                            <button type="button" class="btn btn-light btn-sm rounded-circle" data-bs-dismiss="modal" style="width: 40px; height: 40px;">
                                <i class="fa fa-times"></i>
                            </button>
                        </div>

                        <div class="modal-body p-0 d-flex align-items-center justify-content-center position-relative">
                            <!-- Imagen con zoom -->
                            <img id="zoomImage" src="" alt="Imagen" class="img-fluid" style="max-height: 90vh; max-width: 90vw; object-fit: contain;"/>

                            <!-- Controles de navegación -->
                            <button id="zoomPrevBtn" class="btn btn-light rounded-circle position-absolute start-0 ms-3" style="width: 50px; height: 50px; top: 50%; transform: translateY(-50%);" onclick="navigateZoom(-1)">
                                <i class="fa fa-chevron-left fa-lg"></i>
                            </button>
                            <button id="zoomNextBtn" class="btn btn-light rounded-circle position-absolute end-0 me-3" style="width: 50px; height: 50px; top: 50%; transform: translateY(-50%);" onclick="navigateZoom(1)">
                                <i class="fa fa-chevron-right fa-lg"></i>
                            </button>
                        </div>

                        <!-- Miniaturas en la parte inferior -->
                        <div class="position-absolute bottom-0 start-0 end-0 p-3" style="z-index: 1055; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); overflow-x: auto; white-space: nowrap;">
                            <div id="zoomThumbnails" class="d-flex gap-2 justify-content-center" style="max-width: 100%; overflow-x: auto;">
                                <!-- Miniaturas se cargarán aquí -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- JavaScript para Funcionalidad de Galería -->
            <script type="text/javascript">
                // Variables globales para el zoom
                let currentZoomIndex = 0;
                let zoomImages = [];

                // Contador de imágenes en el carrusel
                document.addEventListener('DOMContentLoaded', function() {
                    const carousel = document.getElementById('propertyImageCarousel');
                    if (carousel) {
                        carousel.addEventListener('slid.bs.carousel', function(e) {
                            const currentIndex = Array.from(e.target.querySelectorAll('.carousel-item')).indexOf(e.relatedTarget) + 1;
                            document.getElementById('currentImageIndex').textContent = currentIndex;
                        });

                        // Cargar todas las imágenes para el zoom
                        const images = carousel.querySelectorAll('.carousel-item img');
                        zoomImages = Array.from(images).map(img => img.src);
                    }

                    // Inicializar mapa (solo cuando se muestra)
                    initializeMap();

                    // Navegación con teclado en el zoom
                    document.addEventListener('keydown', function(e) {
                        const zoomModal = document.getElementById('imageZoomModal');
                        if (zoomModal.classList.contains('show')) {
                            if (e.key === 'ArrowLeft') {
                                navigateZoom(-1);
                            } else if (e.key === 'ArrowRight') {
                                navigateZoom(1);
                            } else if (e.key === 'Escape') {
                                bootstrap.Modal.getInstance(zoomModal).hide();
                            }
                        }
                    });
                });

                // Abrir modal de zoom con la imagen seleccionada
                function openImageZoom(index) {
                    currentZoomIndex = index;
                    const modal = new bootstrap.Modal(document.getElementById('imageZoomModal'));

                    // Actualizar imagen principal
                    updateZoomImage();

                    // Cargar miniaturas
                    loadZoomThumbnails();

                    modal.show();
                }

                // Actualizar imagen en el zoom
                function updateZoomImage() {
                    const zoomImage = document.getElementById('zoomImage');
                    const zoomIndexSpan = document.getElementById('zoomImageIndex');
                    const zoomTotalSpan = document.getElementById('zoomTotalImages');

                    if (zoomImages.length > 0) {
                        zoomImage.src = zoomImages[currentZoomIndex];
                        zoomIndexSpan.textContent = currentZoomIndex + 1;
                        zoomTotalSpan.textContent = zoomImages.length;

                        // Mostrar/ocultar botones de navegación
                        document.getElementById('zoomPrevBtn').style.display = currentZoomIndex > 0 ? 'block' : 'none';
                        document.getElementById('zoomNextBtn').style.display = currentZoomIndex < zoomImages.length - 1 ? 'block' : 'none';

                        // Actualizar miniaturas activas
                        updateActiveThumbnail();
                    }
                }

                // Navegar entre imágenes en el zoom
                function navigateZoom(direction) {
                    currentZoomIndex += direction;

                    // Limitar índices
                    if (currentZoomIndex < 0) currentZoomIndex = 0;
                    if (currentZoomIndex >= zoomImages.length) currentZoomIndex = zoomImages.length - 1;

                    updateZoomImage();
                }

                // Cargar miniaturas en el zoom
                function loadZoomThumbnails() {
                    const container = document.getElementById('zoomThumbnails');
                    let html = '';

                    zoomImages.forEach((src, index) => {
                        html += `
                            <div class="zoom-thumbnail ${index === currentZoomIndex ? 'active' : ''}"
                                 onclick="jumpToZoomImage(${index})"
                                 style="cursor: pointer; opacity: ${index === currentZoomIndex ? '1' : '0.6'}; border: ${index === currentZoomIndex ? '2px solid white' : '2px solid transparent'}; border-radius: 4px; transition: all 0.3s;">
                                <img src="${src}" style="width: 80px; height: 60px; object-fit: cover; border-radius: 4px;" alt="Miniatura ${index + 1}"/>
                            </div>
                        `;
                    });

                    container.innerHTML = html;
                }

                // Saltar a una imagen específica en el zoom
                function jumpToZoomImage(index) {
                    currentZoomIndex = index;
                    updateZoomImage();
                }

                // Actualizar miniatura activa
                function updateActiveThumbnail() {
                    const thumbnails = document.querySelectorAll('.zoom-thumbnail');
                    thumbnails.forEach((thumb, index) => {
                        if (index === currentZoomIndex) {
                            thumb.style.opacity = '1';
                            thumb.style.border = '2px solid white';
                            thumb.classList.add('active');
                            // Scroll horizontal para mantener visible
                            thumb.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                        } else {
                            thumb.style.opacity = '0.6';
                            thumb.style.border = '2px solid transparent';
                            thumb.classList.remove('active');
                        }
                    });
                }

                // Abrir modal de galería
                function openGalleryModal() {
                    const modal = new bootstrap.Modal(document.getElementById('galleryModal'));
                    const grid = document.getElementById('galleryGrid');

                    // Obtener todas las imágenes del carrusel
                    const images = document.querySelectorAll('#propertyImageCarousel .carousel-item img');
                    let html = '';

                    images.forEach((img, index) => {
                        html += `
                            <div class="col-md-4 col-sm-6">
                                <div class="position-relative" style="cursor: pointer;" onclick="goToSlide(${index})">
                                    <img src="${img.src}" class="img-fluid rounded shadow-sm" style="width: 100%; height: 200px; object-fit: cover;" alt="Imagen ${index + 1}"/>
                                    <div class="position-absolute top-0 start-0 m-2 bg-dark text-white px-2 py-1 rounded">
                                        ${index + 1}
                                    </div>
                                </div>
                            </div>
                        `;
                    });

                    grid.innerHTML = html;
                    modal.show();
                }

                // Ir a una diapositiva específica
                function goToSlide(index) {
                    const carousel = bootstrap.Carousel.getInstance(document.getElementById('propertyImageCarousel'));
                    carousel.to(index);
                    bootstrap.Modal.getInstance(document.getElementById('galleryModal')).hide();
                }

                // Alternar entre imagen y mapa
                function toggleMapView() {
                    const mapSection = document.getElementById('mapViewSection');
                    const carouselContainer = document.querySelector('.property-gallery-container');

                    if (mapSection.style.display === 'none') {
                        mapSection.style.display = 'block';
                        carouselContainer.style.display = 'none';

                        // Forzar re-renderizado del mapa
                        if (window.propertyMap) {
                            window.propertyMap.invalidateSize();
                        }
                    } else {
                        mapSection.style.display = 'none';
                        carouselContainer.style.display = 'block';
                    }
                }

                // Inicializar mapa de Leaflet
                function initializeMap() {
                    const mapElement = document.getElementById('property_map');
                    if (!mapElement) return;

                    const lat = parseFloat(mapElement.dataset.lat);
                    const lng = parseFloat(mapElement.dataset.lng);
                    const name = mapElement.dataset.name;

                    if (lat &amp;&amp; lng) {
                        // Solo inicializar cuando se muestre
                        window.initPropertyMap = function() {
                            if (window.propertyMap) return; // Ya inicializado

                            window.propertyMap = L.map('property_map').setView([lat, lng], 15);

                            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                attribution: '© OpenStreetMap contributors'
                            }).addTo(window.propertyMap);

                            L.marker([lat, lng]).addTo(window.propertyMap)
                                .bindPopup('&lt;b&gt;' + name + '&lt;/b&gt;')
                                .openPopup();
                        };
                    }
                }
            </script>

            <!-- Estilos adicionales -->
            <style>
                .property-gallery-container .carousel-control-prev,
                .property-gallery-container .carousel-control-next {
                    opacity: 0;
                    transition: opacity 0.3s;
                }

                .property-gallery-container:hover .carousel-control-prev,
                .property-gallery-container:hover .carousel-control-next {
                    opacity: 1;
                }

                .hover-lift:hover {
                    transform: translateY(-5px);
                    transition: transform 0.3s;
                }

                /* Zoom Modal Styles */
                #imageZoomModal .modal-content {
                    background: rgba(0, 0, 0, 0.95) !important;
                }

                #imageZoomModal img#zoomImage {
                    cursor: zoom-in;
                    transition: transform 0.3s ease;
                }

                #imageZoomModal #zoomPrevBtn,
                #imageZoomModal #zoomNextBtn {
                    opacity: 0.8;
                    transition: opacity 0.3s, transform 0.3s;
                }

                #imageZoomModal #zoomPrevBtn:hover,
                #imageZoomModal #zoomNextBtn:hover {
                    opacity: 1;
                    transform: translateY(-50%) scale(1.1);
                }

                #zoomThumbnails {
                    scrollbar-width: thin;
                    scrollbar-color: rgba(255,255,255,0.3) transparent;
                }

                #zoomThumbnails::-webkit-scrollbar {
                    height: 6px;
                }

                #zoomThumbnails::-webkit-scrollbar-track {
                    background: transparent;
                }

                #zoomThumbnails::-webkit-scrollbar-thumb {
                    background: rgba(255,255,255,0.3);
                    border-radius: 3px;
                }

                #zoomThumbnails::-webkit-scrollbar-thumb:hover {
                    background: rgba(255,255,255,0.5);
                }

                .zoom-thumbnail {
                    flex-shrink: 0;
                }

                .zoom-thumbnail:hover {
                    opacity: 1 !important;
                    transform: scale(1.05);
                }

                /* Cursor zoom-in en las imágenes del carrusel */
                .carousel-item > div[style*="cursor: zoom-in"]:hover {
                    opacity: 0.95;
                }
            </style>
        </t>
    </template>
</odoo>
