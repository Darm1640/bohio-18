<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="theme_bohio_real_estate.property_detail" name="Property Detail">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure property-detail-page">
                <div class="container mt-4 mb-5">
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="card shadow-sm mb-4 border-0" style="border-radius: 16px; overflow: hidden;">
                                <!-- GALERÍA DE IMÁGENES CON CARRUSEL -->
                                <div class="position-relative property-gallery-container">
                                    <!-- Badges superiores -->
                                    <div class="position-absolute top-0 start-0 p-3" style="z-index: 10;">
                                        <span class="badge px-3 py-2" style="background: #E31E24; font-size: 0.9rem;">
                                            <i class="bi bi-star me-1"></i>DESTACADO
                                        </span>
                                    </div>

                                    <!-- Botones de acción (Favorito, Compartir, Reportar) -->
                                    <div class="position-absolute top-0 end-0 p-3 d-flex gap-2" style="z-index: 10;">
                                        <button class="btn btn-light rounded-circle shadow" style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;" title="Favorito">
                                            <i class="bi bi-heart text-danger"></i>
                                        </button>
                                        <button class="btn btn-light rounded-circle shadow" style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;" title="Compartir" onclick="openShareModal()">
                                            <i class="bi bi-share-fill text-primary"></i>
                                        </button>
                                        <button class="btn btn-light rounded-circle shadow" style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;" title="Reportar" onclick="openReportModal()">
                                            <i class="bi bi-flag text-warning"></i>
                                        </button>
                                    </div>

                                    <!-- Carrusel de Imágenes con transición suave -->
                                    <div id="propertyImageCarousel" class="carousel slide carousel-fade" data-bs-ride="false" data-bs-interval="false">
                                        <div class="carousel-inner">
                                            <!-- Usar product_template_image_ids de website_sale -->
                                            <t t-set="images_list" t-value="property.product_template_image_ids or []"/>

                                            <t t-if="len(images_list) > 0">
                                                <!-- Imágenes de la galería -->
                                                <t t-foreach="images_list" t-as="img">
                                                    <div t-att-class="'carousel-item' if img_index > 0 else 'carousel-item active'">
                                                        <div style="width: 100%; padding-top: 56.25%; position: relative; background: #f8f9fa; overflow: hidden; cursor: zoom-in;" t-att-onclick="'openImageZoom(%s)' % img_index">
                                                            <img t-att-src="'/web/image/product.image/%s/image_1920' % img.id"
                                                                 class="position-absolute top-0 start-0 w-100 h-100"
                                                                 style="object-fit: cover;"
                                                                 t-att-alt="property.name"
                                                                 t-att-data-index="img_index"/>
                                                        </div>
                                                    </div>
                                                </t>
                                            </t>
                                            <t t-elif="property.image_1920">
                                                <!-- Imagen principal si no hay galería -->
                                                <div class="carousel-item active">
                                                    <div style="width: 100%; padding-top: 56.25%; position: relative; background: #f8f9fa; overflow: hidden; cursor: zoom-in;" onclick="openImageZoom(0)">
                                                        <img t-att-src="'/web/image/product.template/%s/image_1920' % property.id"
                                                             class="position-absolute top-0 start-0 w-100 h-100"
                                                             style="object-fit: cover;"
                                                             t-att-alt="property.name"
                                                             data-index="0"/>
                                                    </div>
                                                </div>
                                            </t>
                                            <t t-else="">
                                                <!-- Placeholder si no hay imágenes -->
                                                <div class="carousel-item active">
                                                    <div style="width: 100%; padding-top: 56.25%; position: relative; background: #f8f9fa; overflow: hidden;">
                                                        <img src="/theme_bohio_real_estate/static/src/img/banner1.jpg"
                                                             class="position-absolute top-0 start-0 w-100 h-100"
                                                             style="object-fit: cover; opacity: 0.7; filter: brightness(0.8);"
                                                             alt="Propiedad BOHIO"/>
                                                        <div class="position-absolute top-50 start-50 translate-middle text-white text-center"
                                                             style="background: rgba(227, 30, 36, 0.95); padding: 20px 40px; border-radius: 10px;">
                                                            <i class="bi bi-image fa-3x mb-2"></i>
                                                            <p class="mb-0 fw-bold fs-5">Imagen no disponible</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </t>
                                        </div>

                                        <!-- Controles del Carrusel (Anterior/Siguiente) -->
                                        <t t-if="len(images_list) > 1">
                                            <button class="carousel-control-prev" type="button" data-bs-target="#propertyImageCarousel" data-bs-slide="prev" style="width: 50px;">
                                                <div class="bg-white rounded-circle d-flex align-items-center justify-content-center shadow" style="width: 40px; height: 40px;">
                                                    <i class="bi bi-chevron-left text-dark"></i>
                                                </div>
                                                <span class="visually-hidden">Anterior</span>
                                            </button>
                                            <button class="carousel-control-next" type="button" data-bs-target="#propertyImageCarousel" data-bs-slide="next" style="width: 50px;">
                                                <div class="bg-white rounded-circle d-flex align-items-center justify-content-center shadow" style="width: 40px; height: 40px;">
                                                    <i class="bi bi-chevron-right text-dark"></i>
                                                </div>
                                                <span class="visually-hidden">Siguiente</span>
                                            </button>
                                        </t>
                                    </div>

                                    <!-- Contador y Botones en la parte inferior de la imagen -->
                                    <div class="position-absolute bottom-0 start-0 end-0 px-3 py-2 d-flex justify-content-between align-items-center" style="background: linear-gradient(to top, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.3) 50%, transparent 100%); z-index: 10;">
                                        <!-- Contador de Imágenes -->
                                        <t t-set="total_images" t-value="len(property.product_template_image_ids) if property.product_template_image_ids else (1 if property.image_1920 else 1)"/>
                                        <div class="text-white fw-bold px-3 py-2 rounded" style="background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);">
                                            <i class="bi bi-camera me-2"></i>
                                            <span id="currentImageIndex">1</span> / <span id="totalImages" t-esc="total_images"/>
                                        </div>

                                        <!-- Botones Galería y Mapa -->
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-light px-3 py-2 fw-bold" onclick="openGalleryModal()" t-if="total_images > 1">
                                                <i class="bi bi-grid me-2"></i>Galería
                                            </button>
                                            <button class="btn btn-light px-3 py-2 fw-bold" onclick="toggleMapView()" t-if="property.latitude and property.longitude">
                                                <i class="bi bi-map-fill me-2"></i>Mapa
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-3">
                                        <div>
                                            <h1 class="h2 mb-2" t-esc="property.name"/>
                                            <p class="text-muted mb-0">
                                                <i class="bi bi-tag"/> Código: <strong t-esc="property.default_code or 'N/A'"/>
                                            </p>
                                        </div>
                                        <div class="text-end">
                                            <!-- Precio de Venta -->
                                            <t t-if="property.type_service == 'sale' and property.net_price">
                                                <h3 class="text-primary mb-0">
                                                    <span t-field="property.net_price" t-options="{'widget': 'monetary', 'display_currency': property.currency_id}"/>
                                                </h3>
                                                <p class="text-muted small mb-0">Precio de Venta</p>
                                                <p class="text-muted small mb-0" t-if="property.price_per_unit">
                                                    + <span t-field="property.list_price" t-options="{'widget': 'monetary', 'display_currency': property.currency_id}"/> administración
                                                </p>
                                            </t>

                                            <!-- Precio de Arriendo -->
                                            <t t-if="property.type_service == 'rent' and property.net_rental_price">
                                                <h3 class="text-primary mb-0">
                                                    <span t-field="property.net_rental_price" t-options="{'widget': 'monetary', 'display_currency': property.currency_id}"/>
                                                    <small class="fs-6 text-muted">/ mes</small>
                                                </h3>
                                            </t>

                                            <!-- Fallback: list_price si no hay net_price -->
                                            <t t-if="not property.net_price and not property.net_rental_price">
                                                <h3 class="text-primary mb-0">
                                                    <span t-field="property.list_price" t-options="{'widget': 'monetary', 'display_currency': property.currency_id}"/>
                                                </h3>
                                            </t>

                                            <span t-if="property.type_service" class="badge bg-info mt-2">
                                                <span t-esc="property.type_service"/>
                                            </span>
                                        </div>
                                    </div>

                                    <!-- OBSERVACIONES DESTACADAS -->
                                    <t t-if="property.observations">
                                        <div class="alert alert-light border-start border-danger border-4 mb-4">
                                            <h5 class="text-danger mb-3"><i class="bi bi-chat"/> Descripción de la Propiedad</h5>
                                            <div t-field="property.observations" class="text-muted" style="white-space: pre-wrap;"/>
                                        </div>
                                    </t>

                                    <hr/>

                                    <!-- UBICACIÓN DETALLADA -->
                                    <div class="row mb-4">
                                        <div class="col-12">
                                            <div class="card bg-light border-0">
                                                <div class="card-body">
                                                    <h5 class="text-danger mb-3"><i class="bi bi-map-fill-marker"/> Ubicación Completa</h5>
                                                    <div class="row">
                                                        <div class="col-md-6 mb-2" t-if="property.address">
                                                            <i class="bi bi-house-fill text-danger me-2"/>
                                                            <strong>Dirección:</strong> <span t-esc="property.address"/>
                                                        </div>
                                                        <div class="col-md-6 mb-2" t-if="property.region_id">
                                                            <i class="bi bi-map-fill text-danger me-2"/>
                                                            <strong>Barrio:</strong> <span t-esc="property.region_id.name"/>
                                                        </div>
                                                        <div class="col-md-6 mb-2" t-if="property.neighborhood">
                                                            <i class="bi bi-building text-danger me-2"/>
                                                            <strong>Sector:</strong> <span t-esc="property.neighborhood"/>
                                                        </div>
                                                        <div class="col-md-6 mb-2" t-if="property.city">
                                                            <i class="bi bi-map-fill-marker text-danger me-2"/>
                                                            <strong>Ciudad:</strong> <span t-esc="property.city"/>
                                                        </div>
                                                        <div class="col-md-6 mb-2" t-if="property.state_id">
                                                            <i class="bi bi-globe text-danger me-2"/>
                                                            <strong>Departamento:</strong> <span t-esc="property.state_id.name"/>
                                                        </div>
                                                        <div class="col-md-6 mb-2" t-if="property.stratum">
                                                            <i class="bi bi-star text-warning me-2"/>
                                                            <strong>Estrato:</strong> <span t-esc="property.stratum"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- CARACTERÍSTICAS PRINCIPALES -->
                                    <div class="row mb-4">
                                        <div class="col-12">
                                            <h5 class="text-danger mb-3"><i class="bi bi-list-ul"/> Características Principales</h5>
                                        </div>
                                        <div class="col-md-3 col-6 mb-3" t-if="property.property_area">
                                            <div class="text-center p-3 bg-light rounded">
                                                <i class="bi bi-arrows-fullscreen fa-2x text-danger mb-2"/>
                                                <h4 class="mb-0 text-danger" t-esc="'%.0f' % property.property_area"/>
                                                <small class="text-muted">m² Área Total</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 col-6 mb-3" t-if="property.num_bedrooms">
                                            <div class="text-center p-3 bg-light rounded">
                                                <i class="bi bi-bed fa-2x text-danger mb-2"/>
                                                <h4 class="mb-0 text-danger" t-esc="property.num_bedrooms"/>
                                                <small class="text-muted">Habitaciones</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 col-6 mb-3" t-if="property.num_bathrooms">
                                            <div class="text-center p-3 bg-light rounded">
                                                <i class="bi bi-droplet fa-2x text-danger mb-2"/>
                                                <h4 class="mb-0 text-danger" t-esc="property.num_bathrooms"/>
                                                <small class="text-muted">Baños</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 col-6 mb-3" t-if="property.covered_parking or property.uncovered_parking">
                                            <div class="text-center p-3 bg-light rounded">
                                                <i class="bi bi-car-front fa-2x text-danger mb-2"/>
                                                <h4 class="mb-0 text-danger" t-esc="(property.covered_parking or 0) + (property.uncovered_parking or 0)"/>
                                                <small class="text-muted">Parqueaderos</small>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Mapa (inicialmente oculto) -->
                                    <div id="mapViewSection" class="mb-4" style="display: none;">
                                        <hr/>
                                        <h5><i class="bi bi-map-fill text-primary"/> Ubicación en el Mapa</h5>
                                        <div id="property_map" style="height: 400px; width: 100%;" class="mb-4"
                                             t-att-data-lat="property.latitude"
                                             t-att-data-lng="property.longitude"
                                             t-att-data-name="property.name"/>
                                    </div>

                                    <!-- Resto del contenido... (características, amenidades, etc.) -->
                                    <!-- Aquí irían todas las secciones de características que ya teníaslas dejo igual) -->
                                </div>
                            </div>
                        </div>

                        <!-- Sidebar derecho con formulario de contacto -->
                        <div class="col-lg-4">
                            <!-- FORMULARIO DE CONTACTO -->
                            <div class="card shadow-sm sticky-top mb-4" style="top: 20px; border: 2px solid #E31E24;">
                                <div class="card-header text-white" style="background: #E31E24;">
                                    <h5 class="mb-0"><i class="bi bi-envelope"/> Contactar</h5>
                                </div>
                                <div class="card-body">
                                    <form action="/contact/property" t-att-data-property-id="property.id" method="post" class="property-contact-form">
                                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                        <input type="hidden" name="property_id" t-att-value="property.id"/>

                                        <div class="mb-3">
                                            <label class="form-label fw-bold">Nombre Completo *</label>
                                            <input type="text" name="name" class="form-control" required="required" placeholder="Tu nombre completo"/>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label fw-bold">Correo Electrónico *</label>
                                            <input type="email" name="email" class="form-control" required="required" placeholder="tu@email.com"/>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label fw-bold">Teléfono *</label>
                                            <input type="tel" name="phone" class="form-control" required="required" placeholder="+57 300 123 4567"/>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label fw-bold">Mensaje</label>
                                            <textarea name="message" class="form-control" rows="4" placeholder="Estoy interesado en esta propiedad..."></textarea>
                                        </div>

                                        <button type="submit" class="btn w-100 text-white" style="background: #E31E24; border: none;">
                                            <i class="bi bi-send"/> Enviar Consulta
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MODAL DE GALERÍA EN CUADRÍCULA -->
            <div class="modal fade" id="galleryModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-xl modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title"><i class="bi bi-grid me-2"></i>Galería de Imágenes</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row g-3" id="galleryGrid">
                                <!-- Imágenes se cargarán dinámicamente -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MODAL DE ZOOM FULLSCREEN (LIGHTBOX) -->
            <div class="modal fade" id="imageZoomModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="true">
                <div class="modal-dialog modal-fullscreen">
                    <div class="modal-content bg-dark">
                        <!-- Header con botón cerrar y contador -->
                        <div class="position-absolute top-0 start-0 end-0 p-3 d-flex justify-content-between align-items-center" style="z-index: 1055; background: linear-gradient(to bottom, rgba(0,0,0,0.7), transparent);">
                            <div class="text-white fw-bold">
                                <i class="bi bi-camera me-2"></i>
                                <span id="zoomImageIndex">1</span> / <span id="zoomTotalImages">1</span>
                            </div>
                            <button type="button" class="btn btn-light btn-sm rounded-circle" data-bs-dismiss="modal" style="width: 40px; height: 40px;">
                                <i class="bi bi-x"></i>
                            </button>
                        </div>

                        <div class="modal-body p-0 d-flex align-items-center justify-content-center position-relative">
                            <!-- Imagen con zoom -->
                            <img id="zoomImage" src="" alt="Imagen" class="img-fluid" style="max-height: 90vh; max-width: 90vw; object-fit: contain;"/>

                            <!-- Controles de navegación -->
                            <button id="zoomPrevBtn" class="btn btn-light rounded-circle position-absolute start-0 ms-3" style="width: 50px; height: 50px; top: 50%; transform: translateY(-50%);" onclick="navigateZoom(-1)">
                                <i class="bi bi-chevron-left fa-lg"></i>
                            </button>
                            <button id="zoomNextBtn" class="btn btn-light rounded-circle position-absolute end-0 me-3" style="width: 50px; height: 50px; top: 50%; transform: translateY(-50%);" onclick="navigateZoom(1)">
                                <i class="bi bi-chevron-right fa-lg"></i>
                            </button>
                        </div>

                        <!-- Miniaturas en la parte inferior -->
                        <div class="position-absolute bottom-0 start-0 end-0 p-3" style="z-index: 1055; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); overflow-x: auto; white-space: nowrap;">
                            <div id="zoomThumbnails" class="d-flex gap-2 justify-content-center" style="max-width: 100%; overflow-x: auto;">
                                <!-- Miniaturas se cargarán aquí -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MODAL DE COMPARTIR -->
            <div class="modal fade" id="shareModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header" style="background: linear-gradient(135deg, #E31E24 0%, #c91920 100%); color: white;">
                            <h5 class="modal-title">
                                <i class="bi bi-share-fill me-2"></i>Compartir Propiedad
                            </h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <!-- Información de la Propiedad -->
                            <div class="card mb-3 border-0 bg-light">
                                <div class="card-body">
                                    <h6 class="text-danger mb-2">
                                        <i class="bi bi-house-fill me-2"></i><span t-esc="property.name"/>
                                    </h6>
                                    <div class="row g-2 small text-muted">
                                        <div class="col-6" t-if="property.default_code">
                                            <i class="bi bi-tag me-1"></i><strong>Código:</strong> <span t-esc="property.default_code"/>
                                        </div>
                                        <div class="col-6" t-if="property.property_type">
                                            <i class="bi bi-building me-1"></i><strong>Tipo:</strong> <span t-esc="property.property_type"/>
                                        </div>
                                        <div class="col-6" t-if="property.city">
                                            <i class="bi bi-map-fill-marker me-1"></i><strong>Ciudad:</strong> <span t-esc="property.city"/>
                                        </div>
                                        <div class="col-6" t-if="property.property_area">
                                            <i class="bi bi-arrows-fullscreen me-1"></i><strong>Área:</strong> <span t-esc="'%.0f m²' % property.property_area"/>
                                        </div>
                                    </div>

                                    <!-- Precio -->
                                    <div class="mt-2 pt-2 border-top">
                                        <t t-if="property.type_service == 'sale' and property.net_price">
                                            <h5 class="text-primary mb-0">
                                                <span t-field="property.net_price" t-options="{'widget': 'monetary', 'display_currency': property.currency_id}"/>
                                            </h5>
                                            <small class="text-muted">Precio de Venta</small>
                                        </t>
                                        <t t-elif="property.type_service == 'rent' and property.net_rental_price">
                                            <h5 class="text-primary mb-0">
                                                <span t-field="property.net_rental_price" t-options="{'widget': 'monetary', 'display_currency': property.currency_id}"/>
                                                <small class="fs-6 text-muted">/ mes</small>
                                            </h5>
                                            <small class="text-muted">Precio de Arriendo</small>
                                        </t>
                                    </div>

                                    <!-- Observaciones (primeras 150 caracteres) -->
                                    <t t-if="property.observations">
                                        <div class="mt-2 pt-2 border-top">
                                            <small class="text-muted">
                                                <i class="bi bi-chat me-1"></i>
                                                <span t-esc="property.observations[:150] + ('...' if len(property.observations) > 150 else '')"/>
                                            </small>
                                        </div>
                                    </t>
                                </div>
                            </div>

                            <!-- Link para Copiar -->
                            <div class="mb-3">
                                <label class="form-label fw-bold">
                                    <i class="bi bi-link me-1"></i>Link de la Propiedad
                                </label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="propertyShareLink" readonly="readonly" t-attf-value="#{request.httprequest.url_root.rstrip('/')}/property/#{property.id}"/>
                                    <button class="btn btn-outline-danger" type="button" onclick="copyToClipboard()">
                                        <i class="bi bi-clipboard me-1"></i>Copiar
                                    </button>
                                </div>
                                <small class="text-success" id="copySuccess" style="display: none;">
                                    <i class="bi bi-check-circle me-1"></i>Link copiado al portapapeles
                                </small>
                            </div>

                            <hr/>

                            <!-- Compartir en Redes Sociales -->
                            <div>
                                <label class="form-label fw-bold mb-3">
                                    <i class="bi bi-share-fill me-1"></i>Compartir en Redes Sociales
                                </label>
                                <div class="d-grid gap-2">
                                    <!-- WhatsApp -->
                                    <button class="btn text-start text-white d-flex align-items-center" style="background: #25D366;" onclick="shareOnWhatsApp()">
                                        <i class="bi bi-whatsapp fa-2x me-3"></i>
                                        <div class="flex-grow-1">
                                            <strong class="d-block">WhatsApp</strong>
                                            <small class="opacity-75">Enviar por mensaje</small>
                                        </div>
                                    </button>

                                    <!-- Facebook -->
                                    <button class="btn text-start text-white d-flex align-items-center" style="background: #1877F2;" onclick="shareOnFacebook()">
                                        <i class="bi bi-facebook fa-2x me-3"></i>
                                        <div class="flex-grow-1">
                                            <strong class="d-block">Facebook</strong>
                                            <small class="opacity-75">Publicar en tu muro</small>
                                        </div>
                                    </button>

                                    <!-- X (Twitter) -->
                                    <button class="btn text-start text-white d-flex align-items-center" style="background: #000000;" onclick="shareOnTwitter()">
                                        <i class="bi bi-twitter-x fa-2x me-3"></i>
                                        <div class="flex-grow-1">
                                            <strong class="d-block">X (Twitter)</strong>
                                            <small class="opacity-75">Compartir en X</small>
                                        </div>
                                    </button>

                                    <!-- Email -->
                                    <button class="btn text-start text-white d-flex align-items-center" style="background: #6c757d;" onclick="shareViaEmail()">
                                        <i class="bi bi-envelope fa-2x me-3"></i>
                                        <div class="flex-grow-1">
                                            <strong class="d-block">Correo Electrónico</strong>
                                            <small class="opacity-75">Enviar por email</small>
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MODAL DE REPORTE/PQRS -->
            <div class="modal fade" id="reportModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content">
                        <div class="modal-header" style="background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); color: white;">
                            <h5 class="modal-title">
                                <i class="bi bi-flag me-2"></i>Reportar Problema con la Propiedad
                            </h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="alert alert-info border-0 mb-4">
                                <i class="bi bi-info-circle me-2"></i>
                                <strong>¿Encontraste un error?</strong> Ayúdanos a mejorar reportando información incorrecta, imágenes equivocadas o precios desactualizados.
                            </div>

                            <form id="reportForm">
                                <!-- Campos ocultos con información de la propiedad -->
                                <input type="hidden" name="property_id" t-att-value="property.id"/>
                                <input type="hidden" name="property_name" t-att-value="property.name"/>
                                <input type="hidden" name="property_code" t-att-value="property.default_code or ''"/>
                                <input type="hidden" name="property_url" t-attf-value="#{request.httprequest.url_root.rstrip('/')}/property/#{property.id}"/>

                                <!-- Tipo de Problema -->
                                <div class="mb-3">
                                    <label class="form-label fw-bold">
                                        <i class="bi bi-exclamation-triangle text-warning me-1"></i>Tipo de Problema *
                                    </label>
                                    <select class="form-select" name="problem_type" required="required">
                                        <option value="">Selecciona el tipo de problema...</option>
                                        <option value="incorrect_info">Información Incorrecta</option>
                                        <option value="wrong_images">Imágenes Equivocadas o No Corresponden</option>
                                        <option value="wrong_price">Precio Incorrecto o Desactualizado</option>
                                        <option value="wrong_location">Ubicación Incorrecta</option>
                                        <option value="property_not_available">Propiedad No Disponible</option>
                                        <option value="duplicate">Propiedad Duplicada</option>
                                        <option value="other">Otro Problema</option>
                                    </select>
                                </div>

                                <!-- Nombre del Reportante -->
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">
                                            <i class="bi bi-person text-primary me-1"></i>Tu Nombre Completo *
                                        </label>
                                        <input type="text" class="form-control" name="reporter_name" required="required" placeholder="Ej: Juan Pérez"/>
                                    </div>

                                    <!-- Email del Reportante -->
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">
                                            <i class="bi bi-envelope text-primary me-1"></i>Tu Email *
                                        </label>
                                        <input type="email" class="form-control" name="reporter_email" required="required" placeholder="tu@email.com"/>
                                    </div>
                                </div>

                                <!-- Descripción Detallada -->
                                <div class="mb-3">
                                    <label class="form-label fw-bold">
                                        <i class="bi bi-chat text-primary me-1"></i>Descripción del Problema *
                                    </label>
                                    <textarea class="form-control" name="description" rows="4" required="required" placeholder="Por favor describe el problema en detalle. Mínimo 20 caracteres."></textarea>
                                    <small class="text-muted">Mínimo 20 caracteres. Sé lo más específico posible para ayudarnos a resolver el problema.</small>
                                </div>

                                <!-- Información de la Propiedad Reportada -->
                                <div class="card bg-light border-0 mb-3">
                                    <div class="card-body">
                                        <h6 class="text-danger mb-2">
                                            <i class="bi bi-house-fill me-2"></i>Propiedad a Reportar
                                        </h6>
                                        <div class="row g-2 small">
                                            <div class="col-6">
                                                <strong>Nombre:</strong> <span t-esc="property.name"/>
                                            </div>
                                            <div class="col-6" t-if="property.default_code">
                                                <strong>Código:</strong> <span t-esc="property.default_code"/>
                                            </div>
                                            <div class="col-6" t-if="property.city">
                                                <strong>Ciudad:</strong> <span t-esc="property.city"/>
                                            </div>
                                            <div class="col-6" t-if="property.property_type">
                                                <strong>Tipo:</strong> <span t-esc="property.property_type"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                <i class="bi bi-x me-1"></i>Cancelar
                            </button>
                            <button type="button" class="btn btn-warning text-white" onclick="submitReport()">
                                <i class="bi bi-send me-1"></i>Enviar Reporte
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>
