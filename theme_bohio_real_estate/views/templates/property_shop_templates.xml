<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- ============================================================================= -->
    <!-- PROPERTY SHOP TEMPLATES - QWeb Templates for property_shop.js -->
    <!-- ============================================================================= -->

    <!-- Template: Autocomplete Item -->
    <template id="autocomplete_item_template" name="Autocomplete Item Template">
        <li class="autocomplete-item"
            t-att-data-type="result.type"
            t-att-data-id="result.id">

            <!-- Icon -->
            <div t-attf-class="autocomplete-item-icon #{result.iconType}">
                <i t-attf-class="fa #{result.iconClass}"></i>
            </div>

            <!-- Content -->
            <div class="autocomplete-item-content">
                <span class="autocomplete-item-title" t-esc="result.name"/>
                <span class="autocomplete-item-subtitle" t-esc="result.full_name or ''"/>
            </div>

            <!-- Badge -->
            <span class="autocomplete-item-badge" t-esc="result.property_count"/>
        </li>
    </template>

    <!-- Template: Property Card -->
    <!-- BASADO EN property_card_template del home - Estructura unificada -->
    <template id="property_card_shop_template" name="Property Card Shop Template">
        <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 mb-4">
            <div class="card h-100 shadow-sm border-0 bohio-property-card position-relative">

                <!-- Badge de proyecto -->
                <t t-if="property.project_id and property.project_name">
                    <div class="position-absolute top-0 end-0 m-2" style="z-index: 2;">
                        <a t-attf-href="/proyecto/#{property.project_id}"
                           class="badge text-white text-decoration-none property-project-badge"
                           style="background-color: #FF1D25;">
                            <i class="bi bi-building me-1"></i>
                            <t t-esc="property.project_name"/>
                        </a>
                    </div>
                </t>

                <!-- Imagen de la propiedad -->
                <img t-att-src="property.image_url or '/theme_bohio_real_estate/static/src/img/placeholder.jpg'"
                     class="card-img-top property-card-image"
                     t-att-alt="property.name"
                     loading="lazy"
                     style="height: 200px; object-fit: cover;"
                     onerror="this.src='/theme_bohio_real_estate/static/src/img/placeholder.jpg'"/>

                <!-- Cuerpo de la tarjeta -->
                <div class="card-body d-flex flex-column">
                    <!-- Título -->
                    <h5 class="card-title text-truncate mb-2" t-att-title="property.name">
                        <a t-attf-href="/property/#{property.id}"
                           class="text-dark text-decoration-none">
                            <t t-esc="property.name"/>
                        </a>
                    </h5>

                    <!-- Ubicación -->
                    <p class="text-muted small mb-2">
                        <i class="bi bi-geo-alt-fill me-1" style="color: #FF1D25;"></i>
                        <t t-esc="property.location"/>
                    </p>

                    <!-- Características (área, habitaciones, baños, parqueaderos) -->
                    <div class="d-flex justify-content-between mb-2 text-muted small property-features">
                        <span t-if="property.area and property.area > 0">
                            <i class="bi bi-rulers me-1" style="color: #FF1D25;"></i>
                            <t t-esc="property.area_formatted or (str(property.area) + ' m²')"/>
                        </span>
                        <span t-if="property.bedrooms and property.bedrooms > 0">
                            <i class="bi bi-bed me-1" style="color: #FF1D25;"></i>
                            <t t-esc="property.bedrooms"/>
                        </span>
                        <span t-if="property.bathrooms and property.bathrooms > 0">
                            <i class="bi bi-droplet me-1" style="color: #FF1D25;"></i>
                            <t t-esc="property.bathrooms"/>
                        </span>
                        <span t-if="property.parking_spaces and property.parking_spaces > 0">
                            <i class="bi bi-car-front me-1" style="color: #FF1D25;"></i>
                            <t t-esc="property.parking_spaces"/>
                        </span>
                    </div>

                    <!-- Precio -->
                    <div class="mb-2">
                        <small class="text-muted">
                            <t t-esc="property.price_label or 'Precio'"/>
                        </small>
                        <h4 class="mb-0" style="color: #FF1D25;">
                            <t t-esc="property.price_formatted"/>
                        </h4>
                    </div>

                    <!-- Botón ver detalles -->
                    <a t-attf-href="/property/#{property.id}"
                       class="btn w-100 mt-auto text-white"
                       style="background-color: #FF1D25;">
                        <i class="bi bi-eye me-1"></i>Ver detalles
                    </a>
                </div>
            </div>
        </div>
    </template>

    <!-- Template: Map Popup -->
    <template id="property_map_popup_template" name="Property Map Popup Template">
        <div class="property-popup-card" style="min-width: 300px; max-width: 320px;">
            <!-- Popup Image -->
            <div class="popup-image" style="position: relative; height: 180px; overflow: hidden;">
                <img t-att-src="property.image_url"
                     t-att-alt="property.name"
                     style="width: 100%; height: 100%; object-fit: cover;"/>

                <!-- Price Badge - Color rojo BOHIO -->
                <div style="position: absolute; top: 10px; right: 10px;">
                    <span class="badge text-white px-2 py-1" style="background-color: #FF1D25;">
                        <t t-esc="property.price_formatted"/>
                    </span>
                </div>

                <!-- Project Badge (Nuevo) -->
                <t t-if="property.project_id and property.project_name">
                    <div style="position: absolute; bottom: 10px; right: 10px;">
                        <a t-attf-href="/proyecto/#{property.project_id}"
                           class="badge text-white text-decoration-none px-2 py-1"
                           style="background-color: #FF1D25;">
                            <i class="bi bi-building me-1"></i>
                            <t t-esc="property.project_name"/>
                        </a>
                    </div>
                </t>
            </div>

            <!-- Popup Body -->
            <div class="p-3">
                <!-- Title -->
                <h6 class="mb-2 fw-bold">
                    <a t-attf-href="/property/#{property.id}"
                       class="text-dark text-decoration-none">
                        <t t-esc="property.name"/>
                    </a>
                </h6>

                <!-- Service and Type -->
                <div class="mb-2">
                    <span t-attf-class="badge #{property.service_badge_class} me-1">
                        <t t-esc="property.type_service"/>
                    </span>
                    <span class="badge bg-secondary">
                        <t t-esc="property.type_name"/>
                    </span>
                </div>

                <!-- Location -->
                <p class="text-muted small mb-2">
                    <i class="bi bi-geo-alt-fill me-1" style="color: #FF1D25;"></i>
                    <t t-esc="property.location"/>
                </p>

                <!-- Features -->
                <div class="d-flex justify-content-between text-muted small mb-2">
                    <span t-if="property.area">
                        <i class="bi bi-rulers me-1" style="color: #FF1D25;"></i>
                        <t t-esc="property.area_formatted"/>
                    </span>
                    <span t-if="property.bedrooms">
                        <i class="bi bi-bed me-1" style="color: #FF1D25;"></i>
                        <t t-esc="property.bedrooms"/>
                    </span>
                    <span t-if="property.bathrooms">
                        <i class="bi bi-droplet me-1" style="color: #FF1D25;"></i>
                        <t t-esc="property.bathrooms"/>
                    </span>
                </div>

                <!-- View Button -->
                <a t-attf-href="/property/#{property.id}"
                   class="btn btn-sm w-100 text-white"
                   style="background-color: #FF1D25;">
                    <i class="bi bi-eye me-1"></i>Ver Detalles
                </a>
            </div>
        </div>
    </template>

    <!-- Template: Property List (for results) -->
    <template id="property_list_template" name="Property List Template">
        <div class="row" id="propertyResults">
            <t t-foreach="properties" t-as="property">
                <t t-call="theme_bohio_real_estate.property_card_shop_template"/>
            </t>
        </div>
    </template>

    <!-- Template: Loading Spinner -->
    <template id="loading_spinner_template" name="Loading Spinner Template">
        <div class="text-center py-5">
            <div class="spinner-border text-bohio-red" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
            <p class="mt-3 text-muted">Cargando propiedades...</p>
        </div>
    </template>

    <!-- Template: No Results -->
    <template id="no_results_template" name="No Results Template">
        <div class="col-12">
            <div class="alert alert-info text-center">
                <i class="bi bi-info-circle-fill" style="font-size: 3rem; color: #FF1D25;"></i>
                <h5 class="mt-3">No se encontraron propiedades</h5>
                <p class="mb-0">Intenta ajustar los filtros de búsqueda</p>
            </div>
        </div>
    </template>

</odoo>
