<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">

        <!-- ============================================ -->
        <!-- ETAPAS PARA ANTICIPOS DE CLIENTE -->
        <!-- ============================================ -->

        <!-- Etapa 1: Borrador -->
        <record id="stage_customer_draft" model="advance.request.stage">
            <field name="name">Borrador</field>
            <field name="code">draft</field>
            <field name="sequence">1</field>
            <field name="max_days_in_stage">2</field>
            <field name="alert_before_days">1</field>
            <field name="can_create_draft_payment">False</field>
            <field name="can_post_payment">False</field>
            <field name="send_email_to">none</field>
            <field name="show_in_portal">False</field>
            <field name="template_approved">Solicitud iniciada</field>
            <field name="color_time_normal">#6c757d</field>
            <field name="color_time_warning">#ffc107</field>
            <field name="color_time_danger">#dc3545</field>
        </record>

        <!-- Etapa 2: Pendiente Aprobación -->
        <record id="stage_customer_pending" model="advance.request.stage">
            <field name="name">Pendiente Aprobación</field>
            <field name="code">pending</field>
            <field name="sequence">2</field>
            <field name="max_days_in_stage">3</field>
            <field name="alert_before_days">1</field>
            <field name="can_create_draft_payment">False</field>
            <field name="can_post_payment">False</field>
            <field name="send_email_to">internal</field>
            <field name="show_in_portal">True</field>
            <field name="portal_description">Su solicitud está siendo revisada por nuestro equipo</field>
            <field name="template_approved">Enviada para aprobación</field>
            <field name="approval_amount_min">50000</field>
            <field name="color_time_normal">#17a2b8</field>
        </record>

        <!-- Etapa 3: Aprobado -->
        <record id="stage_customer_approved" model="advance.request.stage">
            <field name="name">Aprobado</field>
            <field name="code">approved</field>
            <field name="sequence">3</field>
            <field name="max_days_in_stage">2</field>
            <field name="alert_before_days">1</field>
            <field name="can_create_draft_payment">True</field>
            <field name="can_post_payment">False</field>
            <field name="send_email_to">customer</field>
            <field name="show_in_portal">True</field>
            <field name="portal_description">Su solicitud ha sido aprobada</field>
            <field name="template_approved">Solicitud aprobada exitosamente</field>
            <field name="color_time_normal">#28a745</field>
        </record>

        <!-- Etapa 4: Pagado -->
        <record id="stage_customer_paid" model="advance.request.stage">
            <field name="name">Pagado</field>
            <field name="code">paid</field>
            <field name="sequence">4</field>
            <field name="max_days_in_stage">0</field>
            <field name="can_create_draft_payment">False</field>
            <field name="can_post_payment">True</field>
            <field name="send_email_to">both</field>
            <field name="show_in_portal">True</field>
            <field name="portal_description">El anticipo ha sido procesado</field>
            <field name="template_approved">Pago registrado</field>
            <field name="color_time_normal">#007bff</field>
        </record>

        <!-- ============================================ -->
        <!-- ETAPAS PARA ANTICIPOS DE PROVEEDOR -->
        <!-- ============================================ -->

        <!-- Etapa 1: Borrador -->
        <record id="stage_supplier_draft" model="advance.request.stage">
            <field name="name">Borrador</field>
            <field name="code">draft</field>
            <field name="sequence">1</field>
            <field name="max_days_in_stage">2</field>
            <field name="alert_before_days">1</field>
            <field name="can_create_draft_payment">False</field>
            <field name="can_post_payment">False</field>
            <field name="send_email_to">none</field>
            <field name="show_in_portal">False</field>
            <field name="template_approved">Solicitud iniciada</field>
        </record>

        <!-- Etapa 2: Por Aprobar -->
        <record id="stage_supplier_to_approve" model="advance.request.stage">
            <field name="name">Por Aprobar</field>
            <field name="code">to_approve</field>
            <field name="sequence">2</field>
            <field name="max_days_in_stage">2</field>
            <field name="alert_before_days">1</field>
            <field name="can_create_draft_payment">False</field>
            <field name="can_post_payment">False</field>
            <field name="send_email_to">internal</field>
            <field name="approval_amount_min">100000</field>
            <field name="template_approved">Enviado para aprobación</field>
        </record>

        <!-- Etapa 3: Aprobado -->
        <record id="stage_supplier_approved" model="advance.request.stage">
            <field name="name">Aprobado</field>
            <field name="code">approved</field>
            <field name="sequence">3</field>
            <field name="max_days_in_stage">5</field>
            <field name="alert_before_days">2</field>
            <field name="can_create_draft_payment">True</field>
            <field name="can_post_payment">True</field>
            <field name="send_email_to">customer</field>
            <field name="template_approved">Anticipo aprobado para pago</field>
        </record>

        <!-- Etapa 4: Pagado -->
        <record id="stage_supplier_paid" model="advance.request.stage">
            <field name="name">Pagado</field>
            <field name="code">paid</field>
            <field name="sequence">4</field>
            <field name="max_days_in_stage">0</field>
            <field name="can_create_draft_payment">False</field>
            <field name="can_post_payment">False</field>
            <field name="send_email_to">both</field>
            <field name="template_approved">Pago realizado al proveedor</field>
        </record>

        <!-- ============================================ -->
        <!-- ETAPAS PARA ANTICIPOS DE EMPLEADO -->
        <!-- ============================================ -->

        <record id="stage_employee_draft" model="advance.request.stage">
            <field name="name">Solicitud</field>
            <field name="code">draft</field>
            <field name="sequence">1</field>
            <field name="max_days_in_stage">1</field>
            <field name="alert_before_days">1</field>
            <field name="can_create_draft_payment">False</field>
            <field name="can_post_payment">False</field>
            <field name="send_email_to">none</field>
        </record>

        <record id="stage_employee_approval" model="advance.request.stage">
            <field name="name">Aprobación RRHH</field>
            <field name="code">hr_approval</field>
            <field name="sequence">2</field>
            <field name="max_days_in_stage">2</field>
            <field name="alert_before_days">1</field>
            <field name="can_create_draft_payment">False</field>
            <field name="can_post_payment">False</field>
            <field name="send_email_to">internal</field>
            <field name="approval_amount_min">50000</field>
        </record>

        <record id="stage_employee_approved" model="advance.request.stage">
            <field name="name">Aprobado</field>
            <field name="code">approved</field>
            <field name="sequence">3</field>
            <field name="max_days_in_stage">3</field>
            <field name="alert_before_days">1</field>
            <field name="can_create_draft_payment">True</field>
            <field name="can_post_payment">True</field>
            <field name="send_email_to">customer</field>
        </record>

        <record id="stage_employee_paid" model="advance.request.stage">
            <field name="name">Pagado</field>
            <field name="code">paid</field>
            <field name="sequence">4</field>
            <field name="max_days_in_stage">0</field>
            <field name="can_create_draft_payment">False</field>
            <field name="can_post_payment">False</field>
            <field name="send_email_to">customer</field>
        </record>

        <!-- ============================================ -->
        <!-- TIPOS DE ANTICIPOS -->
        <!-- ============================================ -->

        <!-- Tipo 1: Anticipo de Cliente -->
        <record id="advance_type_customer" model="advance.type">
            <field name="name">Anticipo de Cliente</field>
            <field name="code">ADV_CUST</field>
            <field name="sequence">10</field>
            <field name="operation_code">ADV_CUST</field>
            <field name="default_percentage">30.0</field>
            <field name="min_percentage">10.0</field>
            <field name="max_percentage">50.0</field>
            <field name="min_amount">10000</field>
            <field name="auto_apply">True</field>
            <field name="auto_reconcile">True</field>
            <field name="require_approval">True</field>
            <field name="approval_amount_min">100000</field>
            <field name="stage_ids" eval="[(4, ref('stage_customer_draft')), (4, ref('stage_customer_pending')), (4, ref('stage_customer_approved')), (4, ref('stage_customer_paid'))]"/>
        </record>

        <!-- Tipo 2: Anticipo a Proveedor -->
        <record id="advance_type_supplier" model="advance.type">
            <field name="name">Anticipo a Proveedor</field>
            <field name="code">ADV_SUPP</field>
            <field name="sequence">20</field>
            <field name="operation_code">ADV_SUPP</field>
            <field name="default_percentage">30.0</field>
            <field name="min_percentage">10.0</field>
            <field name="max_percentage">100.0</field>
            <field name="min_amount">50000</field>
            <field name="auto_apply">True</field>
            <field name="auto_reconcile">True</field>
            <field name="require_approval">True</field>
            <field name="approval_amount_min">500000</field>
            <field name="stage_ids" eval="[(4, ref('stage_supplier_draft')), (4, ref('stage_supplier_to_approve')), (4, ref('stage_supplier_approved')), (4, ref('stage_supplier_paid'))]"/>
        </record>

        <!-- Tipo 3: Anticipo a Empleado -->
        <record id="advance_type_employee" model="advance.type">
            <field name="name">Anticipo a Empleado</field>
            <field name="code">ADV_EMP</field>
            <field name="sequence">30</field>
            <field name="operation_code">ADV_EMP</field>
            <field name="default_percentage">0.0</field>
            <field name="min_amount">10000</field>
            <field name="max_amount">2000000</field>
            <field name="auto_apply">False</field>
            <field name="auto_reconcile">False</field>
            <field name="require_approval">True</field>
            <field name="approval_amount_min">100000</field>
            <field name="stage_ids" eval="[(4, ref('stage_employee_draft')), (4, ref('stage_employee_approval')), (4, ref('stage_employee_approved')), (4, ref('stage_employee_paid'))]"/>
        </record>

        <!-- Tipo 4: Viáticos -->
        <record id="advance_type_travel" model="advance.type">
            <field name="name">Viáticos</field>
            <field name="code">ADV_TRAVEL</field>
            <field name="sequence">40</field>
            <field name="operation_code">ADV_TRAVEL</field>
            <field name="default_percentage">0.0</field>
            <field name="min_amount">50000</field>
            <field name="max_amount">5000000</field>
            <field name="auto_apply">False</field>
            <field name="auto_reconcile">False</field>
            <field name="require_approval">True</field>
            <field name="approval_amount_min">200000</field>
            <field name="stage_ids" eval="[(4, ref('stage_employee_draft')), (4, ref('stage_employee_approval')), (4, ref('stage_employee_approved')), (4, ref('stage_employee_paid'))]"/>
        </record>

        <!-- Tipo 5: Caja Menor -->
        <record id="advance_type_petty_cash" model="advance.type">
            <field name="name">Caja Menor</field>
            <field name="code">ADV_PETTY</field>
            <field name="sequence">50</field>
            <field name="operation_code">ADV_PETTY</field>
            <field name="default_percentage">0.0</field>
            <field name="min_amount">10000</field>
            <field name="max_amount">500000</field>
            <field name="auto_apply">False</field>
            <field name="auto_reconcile">False</field>
            <field name="require_approval">False</field>
            <field name="stage_ids" eval="[(4, ref('stage_employee_draft')), (4, ref('stage_employee_approved')), (4, ref('stage_employee_paid'))]"/>
        </record>

        <!-- ============================================ -->
        <!-- PLANTILLAS DE CORREO -->
        <!-- ============================================ -->

        <record id="mail_template_advance_approved" model="mail.template">
            <field name="name">Anticipo Aprobado</field>
            <field name="model_id" ref="model_advance_request"/>
            <field name="subject">Anticipo {{ object.name }} - Aprobado</field>
            <field name="email_from">{{ user.email_formatted }}</field>
            <field name="partner_to">{{ object.partner_id.id }}</field>
            <field name="body_html"><![CDATA[
<div style="font-family: 'Lucida Grande', Ubuntu, Arial, Verdana, sans-serif; font-size: 12px; color: rgb(34, 34, 34); background-color: #FFF;">
    <p>Estimado(a) {{ object.partner_id.name }},</p>
    <p>Le informamos que su solicitud de anticipo <strong>{{ object.name }}</strong> ha sido aprobada.</p>

    <div style="margin: 20px 0;">
        <strong>Detalles del anticipo:</strong>
        <ul>
            <li>Monto solicitado: {{ object.amount_requested }} {{ object.currency_id.symbol }}</li>
            <li>Monto aprobado: {{ object.amount_approved }} {{ object.currency_id.symbol }}</li>
            <li>Fecha de aprobación: {{ object.date_approved }}</li>
            <li>Aprobado por: {{ object.approved_by.name }}</li>
        </ul>
    </div>

    <p>El pago será procesado según nuestros procedimientos habituales.</p>

    <p>Saludos cordiales,<br/>{{ user.company_id.name }}</p>
</div>
            ]]></field>
        </record>

        <record id="mail_template_advance_rejected" model="mail.template">
            <field name="name">Anticipo Rechazado</field>
            <field name="model_id" ref="model_advance_request"/>
            <field name="subject">Anticipo {{ object.name }} - Rechazado</field>
            <field name="email_from">{{ user.email_formatted }}</field>
            <field name="partner_to">{{ object.partner_id.id }}</field>
            <field name="body_html"><![CDATA[
<div style="font-family: 'Lucida Grande', Ubuntu, Arial, Verdana, sans-serif; font-size: 12px; color: rgb(34, 34, 34); background-color: #FFF;">
    <p>Estimado(a) {{ object.partner_id.name }},</p>
    <p>Lamentamos informarle que su solicitud de anticipo <strong>{{ object.name }}</strong> ha sido rechazada.</p>

    <div style="margin: 20px 0;">
        <strong>Motivo del rechazo:</strong>
        <p>{{ object.rejection_reason }}</p>
    </div>

    <p>Si tiene alguna pregunta, no dude en contactarnos.</p>

    <p>Saludos cordiales,<br/>{{ user.company_id.name }}</p>
</div>
            ]]></field>
        </record>

        <record id="mail_template_advance_paid" model="mail.template">
            <field name="name">Anticipo Pagado</field>
            <field name="model_id" ref="model_advance_request"/>
            <field name="subject">Anticipo {{ object.name }} - Pago Realizado</field>
            <field name="email_from">{{ user.email_formatted }}</field>
            <field name="partner_to">{{ object.partner_id.id }}</field>
            <field name="body_html"><![CDATA[
<div style="font-family: 'Lucida Grande', Ubuntu, Arial, Verdana, sans-serif; font-size: 12px; color: rgb(34, 34, 34); background-color: #FFF;">
    <p>Estimado(a) {{ object.partner_id.name }},</p>
    <p>Le confirmamos que el pago del anticipo <strong>{{ object.name }}</strong> ha sido procesado exitosamente.</p>

    <div style="margin: 20px 0;">
        <strong>Detalles del pago:</strong>
        <ul>
            <li>Monto pagado: {{ object.amount_paid }} {{ object.currency_id.symbol }}</li>
            <li>Fecha de pago: {{ object.date_paid }}</li>
        </ul>
    </div>

    <p>Gracias por su preferencia.</p>

    <p>Saludos cordiales,<br/>{{ user.company_id.name }}</p>
</div>
            ]]></field>
        </record>

        <!-- Asignar plantillas a las etapas correspondientes -->
        <record id="stage_customer_approved" model="advance.request.stage">
            <field name="mail_template_id" ref="mail_template_advance_approved"/>
        </record>

        <record id="stage_customer_paid" model="advance.request.stage">
            <field name="mail_template_id" ref="mail_template_advance_paid"/>
        </record>

        <record id="stage_supplier_approved" model="advance.request.stage">
            <field name="mail_template_id" ref="mail_template_advance_approved"/>
        </record>

        <record id="stage_supplier_paid" model="advance.request.stage">
            <field name="mail_template_id" ref="mail_template_advance_paid"/>
        </record>

    </data>
</odoo>