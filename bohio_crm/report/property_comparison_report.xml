<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Plantilla del reporte de comparación -->
    <template id="report_property_comparison_document">
        <t t-call="web.external_layout">
            <div class="page">
                <!-- Header con logo Bohío -->
                <div class="row bohio-header">
                    <div class="col-4">
                        <img src="/bohio_real_estate/static/img/logo-horizontal-bohio.png"
                             style="max-height: 80px;" alt="BOHÍO Inmobiliaria"/>
                    </div>
                    <div class="col-8 text-end">
                        <h2 style="color: #8B4513; font-family: 'Ciutadella SemiBold';">
                            COMPARACIÓN DE PROPIEDADES
                        </h2>
                        <p class="text-muted">
                            <t t-esc="context_timestamp(datetime.datetime.now()).strftime('%d/%m/%Y')"/>
                        </p>
                    </div>
                </div>

                <hr style="border-color: #8B4513; border-width: 2px;"/>

                <!-- Tabla comparativa de propiedades -->
                <div class="row mt-4">
                    <div class="col-12">
                        <table class="table table-bordered table-striped">
                            <thead style="background-color: #8B4513; color: white;">
                                <tr>
                                    <th>Característica</th>
                                    <t t-foreach="docs" t-as="property">
                                        <th class="text-center">
                                            <t t-esc="property.name"/>
                                        </th>
                                    </t>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Imagen principal -->
                                <tr>
                                    <td><strong>Imagen</strong></td>
                                    <t t-foreach="docs" t-as="property">
                                        <td class="text-center">
                                            <img t-if="property.image_1920"
                                                 t-att-src="image_data_uri(property.image_1920)"
                                                 style="max-width: 150px; max-height: 100px;"/>
                                            <span t-else="">Sin imagen</span>
                                        </td>
                                    </t>
                                </tr>

                                <!-- Código de referencia -->
                                <tr>
                                    <td><strong>Código</strong></td>
                                    <t t-foreach="docs" t-as="property">
                                        <td class="text-center">
                                            <t t-esc="property.default_code or 'N/A'"/>
                                        </td>
                                    </t>
                                </tr>

                                <!-- Tipo de propiedad -->
                                <tr>
                                    <td><strong>Tipo</strong></td>
                                    <t t-foreach="docs" t-as="property">
                                        <td class="text-center">
                                            <t t-if="property.property_type">
                                                <t t-esc="dict(property._fields['property_type'].selection).get(property.property_type, 'N/A')"/>
                                            </t>
                                            <t t-else="">N/A</t>
                                        </td>
                                    </t>
                                </tr>

                                <!-- Tipo de servicio -->
                                <tr>
                                    <td><strong>Servicio</strong></td>
                                    <t t-foreach="docs" t-as="property">
                                        <td class="text-center">
                                            <t t-if="property.type_service">
                                                <t t-esc="dict(property._fields['type_service'].selection).get(property.type_service, 'N/A')"/>
                                            </t>
                                            <t t-else="">N/A</t>
                                        </td>
                                    </t>
                                </tr>

                                <!-- Precio -->
                                <tr style="background-color: #FFF8DC;">
                                    <td><strong>Precio</strong></td>
                                    <t t-foreach="docs" t-as="property">
                                        <td class="text-center">
                                            <strong style="color: #8B4513; font-size: 1.2em;">
                                                $<t t-esc="'{:,.0f}'.format(property.list_price)"/>
                                            </strong>
                                        </td>
                                    </t>
                                </tr>

                                <!-- Ubicación -->
                                <tr>
                                    <td><strong>Ubicación</strong></td>
                                    <t t-foreach="docs" t-as="property">
                                        <td class="text-center">
                                            <t t-if="property.city_id">
                                                <t t-esc="property.city_id.name"/>
                                                <t t-if="property.state_id">
                                                    , <t t-esc="property.state_id.name"/>
                                                </t>
                                            </t>
                                            <t t-else="">N/A</t>
                                        </td>
                                    </t>
                                </tr>

                                <!-- Barrio/Sector -->
                                <tr>
                                    <td><strong>Barrio/Sector</strong></td>
                                    <t t-foreach="docs" t-as="property">
                                        <td class="text-center">
                                            <t t-esc="property.neighborhood or 'N/A'"/>
                                        </td>
                                    </t>
                                </tr>

                                <!-- Área de la propiedad -->
                                <tr>
                                    <td><strong>Área Total</strong></td>
                                    <t t-foreach="docs" t-as="property">
                                        <td class="text-center">
                                            <t t-esc="property.property_area"/> m²
                                        </td>
                                    </t>
                                </tr>

                                <!-- Habitaciones -->
                                <tr>
                                    <td><strong>Habitaciones</strong></td>
                                    <t t-foreach="docs" t-as="property">
                                        <td class="text-center">
                                            <t t-esc="property.num_bedrooms or 0"/>
                                        </td>
                                    </t>
                                </tr>

                                <!-- Baños -->
                                <tr>
                                    <td><strong>Baños</strong></td>
                                    <t t-foreach="docs" t-as="property">
                                        <td class="text-center">
                                            <t t-esc="property.num_bathrooms or 0"/>
                                        </td>
                                    </t>
                                </tr>

                                <!-- Estrato -->
                                <tr>
                                    <td><strong>Estrato</strong></td>
                                    <t t-foreach="docs" t-as="property">
                                        <td class="text-center">
                                            <t t-if="property.stratum">
                                                <t t-esc="dict(property._fields['stratum'].selection).get(property.stratum, 'N/A')"/>
                                            </t>
                                            <t t-else="">N/A</t>
                                        </td>
                                    </t>
                                </tr>

                                <!-- Parqueaderos -->
                                <tr>
                                    <td><strong>Parqueaderos</strong></td>
                                    <t t-foreach="docs" t-as="property">
                                        <td class="text-center">
                                            <t t-esc="property.n_garage or 0"/>
                                        </td>
                                    </t>
                                </tr>

                                <!-- Antigüedad -->
                                <tr>
                                    <td><strong>Antigüedad (años)</strong></td>
                                    <t t-foreach="docs" t-as="property">
                                        <td class="text-center">
                                            <t t-esc="property.property_age or 'N/A'"/>
                                        </td>
                                    </t>
                                </tr>

                                <!-- Estado de la propiedad -->
                                <tr>
                                    <td><strong>Estado</strong></td>
                                    <t t-foreach="docs" t-as="property">
                                        <td class="text-center">
                                            <t t-if="property.property_status">
                                                <t t-esc="dict(property._fields['property_status'].selection).get(property.property_status, 'N/A')"/>
                                            </t>
                                            <t t-else="">N/A</t>
                                        </td>
                                    </t>
                                </tr>

                                <!-- Características adicionales -->
                                <tr>
                                    <td><strong>Características</strong></td>
                                    <t t-foreach="docs" t-as="property">
                                        <td>
                                            <ul style="list-style-type: none; padding-left: 0;">
                                                <li t-if="property.pools">✓ Piscina</li>
                                                <li t-if="property.gym">✓ Gimnasio</li>
                                                <li t-if="property.elevator">✓ Ascensor</li>
                                                <li t-if="property.has_security">✓ Seguridad 24h</li>
                                                <li t-if="property.garden">✓ Jardín</li>
                                                <li t-if="property.terrace">✓ Terraza</li>
                                                <li t-if="property.balcony">✓ Balcón</li>
                                                <li t-if="property.air_conditioning">✓ Aire Acondicionado</li>
                                                <li t-if="property.furnished">✓ Amoblado</li>
                                            </ul>
                                        </td>
                                    </t>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Footer con información de contacto -->
                <div class="row mt-5" style="border-top: 2px solid #8B4513; padding-top: 20px;">
                    <div class="col-6">
                        <h5 style="color: #8B4513;">BOHÍO Inmobiliaria</h5>
                        <p>
                            <strong>Teléfono:</strong> (+57) 300 123 4567<br/>
                            <strong>Email:</strong> info@bohio.com.co<br/>
                            <strong>Web:</strong> www.bohio.com.co
                        </p>
                    </div>
                    <div class="col-6 text-end">
                        <p style="color: #666; font-style: italic;">
                            "Tu hogar, nuestra pasión"<br/>
                            <small>Este documento es confidencial y está dirigido únicamente al destinatario.</small>
                        </p>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Definición del reporte -->
    <record id="report_property_comparison" model="ir.actions.report">
        <field name="name">Comparación de Propiedades</field>
        <field name="model">product.template</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">bohio_crm.report_property_comparison_document</field>
        <field name="report_file">bohio_crm.report_property_comparison</field>
        <field name="print_report_name">'Comparacion_Propiedades_' + (datetime.datetime.now().strftime('%Y%m%d'))</field>
        <field name="binding_model_id" ref="product.model_product_template"/>
        <field name="binding_type">report</field>
        <field name="groups_id" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <!-- Plantilla de comparación desde CRM Lead -->
    <template id="report_crm_property_comparison_document">
        <t t-call="web.external_layout">
            <t t-foreach="docs" t-as="o">
            <div class="page">
                <div class="row bohio-header">
                    <div class="col-4">
                        <img src="/bohio_real_estate/static/description/icon.png"
                             style="max-height: 60px;" alt="BOHÍO"/>
                    </div>
                    <div class="col-8 text-end">
                        <h2 style="color: #ff1d25; font-weight: 700;">
                            COMPARATIVO DE PROPIEDADES
                        </h2>
                        <p class="text-muted">
                            <t t-esc="context_timestamp(datetime.datetime.now()).strftime('%d/%m/%Y')"/>
                        </p>
                    </div>
                </div>

                <hr style="border-color: #ff1d25; border-width: 2px;"/>

                <!-- Cliente -->
                <div class="row mt-3 mb-4">
                    <div class="col-12">
                        <h5 style="color: #ff1d25;">Preparado para:</h5>
                        <p><strong><t t-esc="o.partner_id.name if o.partner_id else 'Cliente'"/></strong></p>
                        <t t-if="o.partner_id">
                            <p t-if="o.partner_id.email">Email: <t t-esc="o.partner_id.email"/></p>
                            <p t-if="o.partner_id.phone">Teléfono: <t t-esc="o.partner_id.phone"/></p>
                        </t>
                    </div>
                </div>

                <!-- Obtener propiedades -->
                <t t-set="properties" t-value="o.compared_properties_ids"/>

                <!-- Comparativo visual -->
                <div class="row mt-4">
                    <t t-foreach="properties" t-as="prop">
                        <div t-att-class="'col-%s' % (12 // min(len(properties), 4) if len(properties) > 0 else 12)">
                            <div style="border: 2px solid #ff1d25; border-radius: 12px; overflow: hidden; margin-bottom: 20px;">
                                <img t-if="prop.image_1920"
                                     t-att-src="image_data_uri(prop.image_1920)"
                                     style="width: 100%; height: 200px; object-fit: cover;"/>
                                <div style="padding: 16px; background: white;">
                                    <h4 style="color: #ff1d25; margin: 0;"><t t-esc="prop.name"/></h4>
                                    <p style="margin: 8px 0; color: #666;">
                                        <i class="fa fa-barcode"/> <t t-esc="prop.default_code or 'N/A'"/>
                                    </p>
                                    <div style="margin: 12px 0; padding: 12px; background: #f8f9fa; border-radius: 8px;">
                                        <div style="font-size: 24px; font-weight: 700; color: #ff1d25;">
                                            $<t t-esc="'{:,.0f}'.format(prop.list_price)"/>
                                        </div>
                                    </div>
                                    <div style="margin-top: 12px;">
                                        <p style="margin: 4px 0;"><i class="fa fa-map-marker"/> <t t-esc="prop.neighborhood or 'N/A'"/>, <t t-esc="prop.municipality or 'N/A'"/></p>
                                        <p style="margin: 4px 0;"><i class="fa fa-arrows-alt"/> <t t-esc="prop.property_area or 0"/> m²</p>
                                        <p style="margin: 4px 0;"><i class="fa fa-bed"/> <t t-esc="prop.num_bedrooms or 0"/> habitaciones</p>
                                        <p style="margin: 4px 0;"><i class="fa fa-bath"/> <t t-esc="prop.num_bathrooms or 0"/> baños</p>
                                        <p style="margin: 4px 0;"><i class="fa fa-car"/> <t t-esc="prop.n_garage or 0"/> parqueaderos</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>

                <!-- Mensaje del Agente -->
                <div class="row mt-4" style="background: #fff8f8; border-left: 4px solid #ff1d25; padding: 20px; border-radius: 8px;">
                    <div class="col-12">
                        <h5 style="color: #ff1d25; margin-bottom: 12px;">
                            <i class="fa fa-user-circle"/> Su Asesor Inmobiliario
                        </h5>
                        <p style="margin: 0 0 12px 0; font-size: 14px; line-height: 1.6;">
                            <strong><t t-esc="o.user_id.name if o.user_id else 'Equipo BOHÍO'"/></strong><br/>
                            <t t-if="o.user_id and o.user_id.phone">
                                <i class="fa fa-phone"/> <t t-esc="o.user_id.phone"/><br/>
                            </t>
                            <t t-if="o.user_id and o.user_id.email">
                                <i class="fa fa-envelope"/> <t t-esc="o.user_id.email"/>
                            </t>
                        </p>
                        <p style="margin: 0; font-size: 13px; font-style: italic; color: #666;">
                            "¿Listo para encontrar tu hogar ideal? <strong style="color: #ff1d25;">¡Llámame ahora!</strong>
                            Estoy aquí para ayudarte a tomar la mejor decisión y guiarte en cada paso del proceso."
                        </p>
                    </div>
                </div>

                <!-- Footer -->
                <div class="row mt-4" style="border-top: 2px solid #ff1d25; padding-top: 20px;">
                    <div class="col-6">
                        <h5 style="color: #ff1d25;">BOHÍO Inmobiliaria</h5>
                        <p style="margin: 0; font-size: 12px; color: #666;">
                            Tu hogar, nuestra pasión
                        </p>
                    </div>
                    <div class="col-6 text-end">
                        <p style="margin: 0; font-size: 11px; color: #999;">
                            Documento confidencial
                        </p>
                    </div>
                </div>
            </div>
            </t>
        </t>
    </template>

    <!-- Reporte desde CRM -->
    <record id="action_report_property_comparison" model="ir.actions.report">
        <field name="name">Comparativo de Propiedades</field>
        <field name="model">crm.lead</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">bohio_crm.report_crm_property_comparison_document</field>
        <field name="report_file">bohio_crm.report_crm_property_comparison</field>
        <field name="print_report_name">'Comparativo_%s' % (object.name)</field>
        <field name="binding_model_id" ref="crm.model_crm_lead"/>
        <field name="binding_type">report</field>
    </record>
</odoo>
